---
layout: default
title: 検索
permalink: /pages/search.html
---

<div class="container" style="max-width:960px;margin:2rem auto;">
  <h1>サイト内検索</h1>
  <input id="search-input" type="search" placeholder="キーワードを入力" 
         style="width:100%;padding:.75rem;border:1px solid #ccc;border-radius:8px;">
  <div id="search-meta" style="margin:.5rem 0;color:#666;"></div>
  <div id="search-results" style="display:grid;gap:10px;"></div>
</div>

<script>
(() => {
  const INDEX_URL = ("{{ site.baseurl }}/search.json").replace(/\/+/g, "/");
  const $input = document.getElementById("search-input");
  const $meta = document.getElementById("search-meta");
  const $results = document.getElementById("search-results");
  let DATA = [];

  // 部分一致＋スコアっぽい並び替え
  function search(q) {
    const query = q.trim().toLowerCase();
    let res = !query ? [] : DATA.filter(it =>
      (it.title + it.excerpt + it.content).toLowerCase().includes(query)
    );
    // タイトル一致優先
    res.sort((a,b)=>{
      const aMatch=a.title.toLowerCase().includes(query)?1:0;
      const bMatch=b.title.toLowerCase().includes(query)?1:0;
      const da=new Date(a.date), db=new Date(b.date);
      return (bMatch-aMatch)||(db-da);
    });
    $meta.textContent = query ? `結果：${res.length}件` : "";
    $results.innerHTML = res.map(it => `
      <article class="card">
        <a href="${it.url}" style="font-weight:600;">${it.title}</a><br>
        <small style="color:#666;">${it.date||""}</small>
        <p style="margin-top:4px;">${it.excerpt}</p>
      </article>
    `).join("") || (query ? "<p>該当なし</p>" : "");
  }

  fetch(INDEX_URL).then(r=>r.json()).then(json=>{
    DATA=json;
    $meta.textContent=`データ読み込み完了（${json.length}件）`;
  });
  $input.addEventListener("input",e=>search(e.target.value));
})();
</script>
