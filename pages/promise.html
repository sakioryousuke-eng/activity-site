---
layout: default
title: 公約と進捗
---

<h1>📌 公約と進捗</h1>
<p>カードをタップするとPDFがモーダルで開きます（スマホでも見切れません／PDFはドラッグ不可）。</p>

<div class="grid">
{% for p in site.data.promises.promises %}
  <div class="card">
    <a class="stretched" href="{{ p.pdf | relative_url }}" data-modal="pdf" data-title="{{ p.title }}"></a>
    <div class="title">{{ p.title }} <span class="chip s-{{ p.status }}">{{ p.status }}</span></div>
    <div>{{ p.detail }}</div>
    <small>最終更新: {{ p.last_update }}</small>
    {% if p.pdf %}<div class="hint">📄 タップでPDFを開く</div>{% endif %}
  </div>
{% endfor %}
</div>

<style>
.grid{display:grid;gap:1.2rem;grid-template-columns:1fr}
@media(min-width:720px){.grid{grid-template-columns:1fr 1fr}}
.card{position:relative;border-radius:16px;padding:1.2rem;background:#fff;box-shadow:0 4px 10px rgba(0,0,0,.05)}
.card:hover{transform:translateY(-3px);box-shadow:0 6px 12px rgba(0,0,0,.1)}
.stretched{position:absolute;inset:0;z-index:1;text-indent:-9999px}
.title{font-weight:700;margin-bottom:.4rem}
.chip{font-size:.8rem;padding:.2rem .6rem;border-radius:999px;margin-left:.4rem}
.s-構想中{background:#fee2e2;color:#991b1b}
.s-経過観察中{background:#fef3c7;color:#92400e}
.s-活動中{background:#d1fae5;color:#065f46}
.s-継続{background:#ede9fe;color:#5b21b6}
.hint{position:absolute;bottom:8px;right:10px;color:#6b7280;font-size:.8rem}
</style>

<!-- ▼ 公約専用PDFモーダル（元の正しい実装） -->
<dialog id="promisePdf" aria-label="PDFを表示">
  <div class="phead">
    <strong id="ptitle">PDF</strong>
    <button id="pclose" aria-label="閉じる">×</button>
  </div>
  <div class="pbody">
    <iframe id="pframe" title="PDF表示" loading="lazy" referrerpolicy="no-referrer"></iframe>
  </div>
</dialog>

<style>
#promisePdf{
  position:fixed; inset:0; margin:0; padding:0; border:none; background:#fff;
  width:100vw; height:100svh; max-width:100vw; border-radius:0; overflow:hidden;
  --ph: 60px;
}
@supports not (height:100svh){ #promisePdf{ height:100dvh; } }
#promisePdf::backdrop{ background:rgba(0,0,0,.35); }
#promisePdf .phead{
  display:flex; justify-content:space-between; align-items:center;
  border-bottom:1px solid #eee; background:#fff; min-height:48px;
  padding:.7rem .9rem;
  padding-top:calc(.7rem + env(safe-area-inset-top));
}
#promisePdf .phead button{ border:none; background:#fff; font-size:1.1rem; line-height:1; border-radius:8px; padding:.3rem .5rem; cursor:pointer; }
#promisePdf .pbody{
  position:absolute; inset:var(--ph) 0 0 0; background:#fff; overflow:hidden;
}
#pframe{
  display:block; width:100%; height:100%; border:0; background:#fff;
  height:-webkit-fill-available;          /* Safari 余白対策 */
  pointer-events:none; user-select:none;  /* PDFはドラッグ/ズーム不可 */
}
body.__lock{ overflow:hidden; }
</style>

{% raw %}
<script>
document.addEventListener('DOMContentLoaded', () => {
  const dlg   = document.getElementById('promisePdf');
  const head  = dlg.querySelector('.phead');
  const frame = document.getElementById('pframe');
  const title = document.getElementById('ptitle');
  const btn   = document.getElementById('pclose');

  function toZoom50(href){
    try{
      const url = new URL(href, location.href);
      const sp  = new URLSearchParams(url.hash.replace(/^#/,''));
      sp.set('zoom','50'); sp.set('toolbar','0'); sp.set('navpanes','0');
      url.hash = sp.toString();
      return url.toString();
    }catch(_){
      return href + (href.includes('#') ? '&' : '#') + 'zoom=50&toolbar=0&navpanes=0';
    }
  }
  function applyHeadHeight(){
    const h = Math.ceil(head.getBoundingClientRect().height);
    dlg.style.setProperty('--ph', h + 'px');
  }
  function openPdf(href, ttl){
    title.textContent = ttl || 'PDF';
    frame.src = toZoom50(href);
    applyHeadHeight();
    document.body.classList.add('__lock');
    dlg.showModal();
  }
  function closePdf(){
    frame.src = 'about:blank';
    dlg.close();
    document.body.classList.remove('__lock');
  }

  btn.addEventListener('click', closePdf);
  dlg.addEventListener('close', closePdf);
  window.addEventListener('resize', ()=>{ if(dlg.open) applyHeadHeight(); });
  window.addEventListener('orientationchange', ()=>{ if(dlg.open) applyHeadHeight(); });

  document.addEventListener('click', function(e){
    const a = e.target.closest('a[data-modal="pdf"]');
    if(!a) return;
    e.preventDefault();
    openPdf(a.getAttribute('href'), a.dataset.title || a.textContent || 'PDF');
  }, {passive:false});
});
</script>
{% endraw %}
<!-- ▲ 公約専用PDFモーダル -->

