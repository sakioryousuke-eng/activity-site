---
layout: default
title: 一般質問マトリクス
---

<h1>💬 一般質問マトリクス</h1>
<p>行をタップすると詳細カードを開きます。PDFリンクはモーダルでその場表示（スマホでも見切れません）。</p>

<div class="toolbar">
  <div class="filters">
    <button class="fbtn active" data-filter="ALL">すべて</button>
    <button class="fbtn" data-filter="EDU">📘 教育</button>
    <button class="fbtn" data-filter="WEL">💗 福祉</button>
    <button class="fbtn" data-filter="TOUR">🏞 観光</button>
    <button class="fbtn" data-filter="OTHER">🧩 その他</button>
  </div>
  <input id="kw" type="search" placeholder="キーワード（年月・要旨・会期）" aria-label="キーワード検索">
</div>

<div class="matrix-wrap">
  <table class="matrix" id="matrixTable">
    <thead>
      <tr>
        <th id="th-month" class="sortable" data-order="desc">年月 ▼</th>
        <th>質問要旨／会期</th>
        <th id="th-cat" class="sortable" data-order="asc">分野 ▲</th>
        <th>資料</th>
      </tr>
    </thead>
    <tbody>
      {% for cat in site.data.matrix %}
        {% assign catname = cat[0] %}
        {% assign catlist = cat[1] %}
        {% assign c = catname | replace:'　','' | replace:' ',' ' | downcase %}
        {% capture catkey %}
          {% if c == '' %}OTHER
          {% elsif c contains '教' or c contains 'education' %}EDU
          {% elsif c contains '福' or c contains 'welfare' or c contains 'child' %}WEL
          {% elsif c contains '観' or c contains 'tour' %}TOUR
          {% else %}OTHER
          {% endif %}
        {% endcapture %}
        {% assign catkey = catkey | strip | upcase %}

        {% for entry in catlist %}
          {% assign s = entry.sakio %}
          {% if s %}
          <tr class="row"
              data-title="{{ s.text }}"
              data-session="{{ s.session }}"
              data-month="{{ s.month }}"
              data-monthnum="{{ s.month | replace:'-','' | plus:0 }}"
              data-category="{{ catname }}"
              data-catkey="{{ catkey }}"
              data-pdf="{{ s.pdf | relative_url }}"
              data-related='{{ entry.related | jsonify }}'>
            <td>{{ s.month }}</td>
            <td>
              <div class="q-title">{{ s.text }}</div>
              <div class="q-session">{{ s.session }}</div>
            </td>
            <td><span>{{ catname }}</span></td>
            <td>
              {% if s.pdf %}
                <a href="{{ s.pdf | relative_url }}" data-modal="pdf" data-title="{{ s.text }}">PDF</a>
              {% else %}
                <span class="muted">—</span>
              {% endif %}
            </td>
          </tr>
          {% endif %}
        {% endfor %}
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- 📄 PDFモーダル（公約ページと同一仕様） -->
<dialog id="pdfModal" aria-label="PDF表示">
  <div class="modal-head">
    <strong id="pdfTitle">PDF</strong>
    <button id="closePdf" aria-label="閉じる">×</button>
  </div>
  <div class="pdf-body">
    <iframe id="pdfFrame" title="PDF表示" loading="lazy"></iframe>
  </div>
</dialog>

<style>
.matrix-wrap{overflow:auto;border:1px solid #eee;border-radius:12px}
table.matrix{width:100%;border-collapse:collapse;font-size:.93rem}
th,td{padding:.4rem .6rem;border-bottom:1px solid #f1f5f9}
thead th{background:#fafafa;position:sticky;top:0}
.q-title{font-weight:700}
.q-session{font-size:.8rem;color:#64748b}
.muted{color:#999}

/* モーダル（公約ページと同じ） */
dialog#pdfModal{
  border:none;margin:0;padding:0;background:#fff;
  max-width:100vw;width:100vw;height:100vh;border-radius:0;
}
dialog#pdfModal::backdrop{background:rgba(0,0,0,.35)}
.modal-head{display:flex;justify-content:space-between;align-items:center;
  padding:.7rem .9rem;border-bottom:1px solid #eee;background:#fff}
.pdf-body{height:calc(100vh - 48px)}
#pdfFrame{width:100%;height:100%;border:0;display:block;background:#fff}
</style>

{% raw %}
<script>
document.addEventListener('DOMContentLoaded', () => {
  const pdfDlg = document.getElementById('pdfModal');
  const pdfFrame = document.getElementById('pdfFrame');
  const pdfTitle = document.getElementById('pdfTitle');
  const closePdf = document.getElementById('closePdf');

  // PDFモーダル（公約ページと同じ仕組み）
  document.addEventListener('click', e => {
    const a = e.target.closest('a[data-modal="pdf"]');
    if(!a) return;
    e.preventDefault();
    pdfTitle.textContent = a.dataset.title || 'PDF';
    pdfFrame.src = a.href + '#view=Fit&zoom=page-fit';
    pdfDlg.showModal();
  });
  closePdf.addEventListener('click',()=>{
    pdfFrame.src='about:blank';
    pdfDlg.close();
  });
});
</script>
{% endraw %}

