---
layout: default
title: ä¸€èˆ¬è³ªå•ï¼ˆã‚«ãƒ†ã‚´ãƒªåˆ¥ãƒ»ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰
permalink: /pages/matrix.html
---

<h2 style="margin:0 0 10px;">ä¸€èˆ¬è³ªå•ï¼ˆã‚«ãƒ†ã‚´ãƒªåˆ¥ãƒ»ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰</h2>
<p class="muted" style="margin:6px 0 16px;">è¡Œã‚¿ãƒƒãƒ—ã§è©³ç´°ã€‚ç’°å¢ƒã«ã‚ˆã‚Šãƒ¢ãƒ¼ãƒ€ãƒ« or ä¸‹éƒ¨ãƒ‘ãƒãƒ«ãŒé–‹ãã¾ã™ã€‚ä¸Šéƒ¨ãƒœã‚¿ãƒ³ã§åˆ†é‡ãƒ•ã‚£ãƒ«ã‚¿ã€ãƒ˜ãƒƒãƒ€ãƒ¼çŸ¢å°ã§æ˜‡é™åˆ‡æ›¿ã€‚</p>

<style>
/* ============= åŸºæœ¬æ§‹é€  ============= */
body, h1, h2, h3, p, td, th, button, a {
  font-family: "Noto Sans JP","Hiragino Sans","Yu Gothic UI","æ¸¸ã‚´ã‚·ãƒƒã‚¯ä½“","Meiryo",system-ui,sans-serif;
}
.muted{color:#64748b}
.matrix-wrap{overflow:auto;border:1px solid #eee;border-radius:12px;background:#fff}
table.matrix{width:100%;border-collapse:collapse;font-size:.95rem;table-layout:fixed}
.matrix th,.matrix td{padding:.5rem .6rem;border-bottom:1px solid #f1f5f9;vertical-align:middle}
.matrix thead th{position:sticky;top:0;background:#fafafa;z-index:1;white-space:nowrap;user-select:none}
.matrix tbody tr:hover{background:#fcfcff}

/* åˆ—å¹…ï¼šè¦æ—¨åºƒã‚ãƒ»åˆ†é‡ç´°ã‚ */
.col-month{width:5.0rem}
.col-cat{width:3.0rem}
.col-act{width:6.0rem}
@media(max-width:840px){.col-month{width:4.8rem}.col-cat{width:2.8rem}.col-act{width:5.8rem}}
@media(max-width:480px){.col-month{width:4.6rem}.col-cat{width:2.6rem}.col-act{width:5.4rem}}

/* è¦æ—¨ãƒ»ä¼šæœŸ */
.cell-title{
  font-weight:700;line-height:1.35;overflow:hidden;text-overflow:ellipsis;
  display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical
}
.cell-session{font-size:.86rem;color:#64748b;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}

/* ============= ã‚½ãƒ¼ãƒˆãƒœã‚¿ãƒ³ ============= */
.sort-btn{
  display:inline-flex;align-items:center;gap:.4rem;
  border:none;background:transparent;cursor:pointer;font:inherit;padding:.25rem .3rem;margin:-.25rem 0;
}
.sort-btn:focus{outline:3px solid #93c5fd;outline-offset:2px;border-radius:6px}
.sort-icon{width:14px;height:14px;display:inline-block}
.chev{transition:transform .15s ease, opacity .15s ease;opacity:.65}
[aria-sort="ascending"] .chev{transform:rotate(180deg)}
[aria-sort="descending"] .chev{transform:rotate(0deg)}
.sort-btn:hover .chev{opacity:1}

/* ============= ä¸Šéƒ¨ã‚«ãƒ†ã‚´ãƒªãƒ•ã‚£ãƒ«ã‚¿ ============= */
.filter-bar{display:flex;flex-wrap:wrap;gap:8px;align-items:center;margin:10px 0 12px;}
.filter-btn{
  display:inline-flex;align-items:center;gap:.45em;
  padding:.42rem .78rem;border:1px solid #d6d6dc;border-radius:999px;background:#fff;cursor:pointer;
  font-size:.86rem;line-height:1;text-decoration:none;font-weight:700;
}
.filter-btn[aria-pressed="true"]{background:#eef2ff;border-color:#c7d2fe}
.count{color:#64748b;font-variant-numeric:tabular-nums;font-weight:600}
.ficon{font-size:1rem;line-height:1}
.fb-edu .ficon{color:#3b82f6}.fb-wel .ficon{color:#ef476f}.fb-tour .ficon{color:#22c55e}.fb-oth .ficon{color:#94a3b8}

/* ============= åˆ†é‡ãƒ”ãƒ«ï¼ˆç¸¦ã‚¢ã‚¤ã‚³ãƒ³ï¼‹1æ–‡å­—ï¼‰ ============= */
.cat-pill{
  display:inline-flex;flex-direction:column;align-items:center;justify-content:center;gap:.12rem;
  padding:.28rem .3rem;border-radius:9px;font-weight:800;color:#fff;min-width:2.6rem;
}
.cat-pill .icon{font-size:.95rem;line-height:1}
.cat-pill .label{font-size:.72rem;line-height:1}
.cat-edu{background:#3b82f6} /* æ•™è‚² */
.cat-wel{background:#ef476f} /* ç¦ç¥‰ */
.cat-tour{background:#22c55e}/* è¦³å…‰ */
.cat-oth{background:#94a3b8} /* ãã®ä»– */

/* ============= æ±ç”¨ãƒœã‚¿ãƒ³ï¼ˆãƒ¢ãƒ¼ãƒ€ãƒ«ã®Ã—ç”¨ï¼‰ ============= */
.btn{display:inline-flex;align-items:center;gap:.3em;padding:.28rem .6rem;border:1px solid #d6d6dc;border-radius:10px;background:#fff;text-decoration:none;font-size:.86rem;line-height:1;white-space:nowrap}
.btn:hover{background:#f5f7ff}

/* ============= PDFï¼è©³ç´°ãƒãƒƒã‚¸ï¼ˆæœ€çµ‚ãƒ‡ã‚¶ã‚¤ãƒ³ï¼‰ ============= */
.matrix td:last-child .actions{
  display:flex !important;
  flex-direction:column;          /* ç¸¦ä¸¦ã³ */
  align-items:flex-end;
  justify-content:center;
  gap:6px;
  padding-right:6px;
}
.matrix td:last-child .actions .btn{
  display:inline-flex;
  align-items:center;
  gap:4px;
  font-size:11px;
  font-weight:600;
  border-radius:8px;
  padding:3px 8px;
  line-height:1.2;
  background:#fff;
  text-decoration:none;
  border:1.5px solid transparent;
  box-shadow:0 1px 2px rgba(0,0,0,0.06);
  transition:all .15s ease;
  white-space:nowrap;
}

/* ğŸŸ£ PDFï¼šç´«ï¼‹è‰²æ–‡å­—ï¼‹å›²ã¿ */
.matrix td:last-child .actions .btn.pdf-link{
  border-color:#c7b8ff;
  background:#f5f3ff;
  color:#4f46e5;
}
.matrix td:last-child .actions .btn.pdf-link:hover{
  background:#ede9fe;
  border-color:#a78bfa;
}

/* âšª è©³ç´°ï¼šç°é’ï¼‹å›²ã¿ */
.matrix td:last-child .actions .btn.ghost{
  border-color:#cbd5e1;
  background:#f8fafc;
  color:#475569;
}
.matrix td:last-child .actions .btn.ghost:hover{
  background:#f1f5f9;
  border-color:#94a3b8;
}

/* ã‚¢ã‚¤ã‚³ãƒ³ */
.matrix td:last-child .actions .btn.pdf-link::before{content:"ğŸ“„";font-size:12px;}
.matrix td:last-child .actions .btn.ghost::before{content:"ğŸ”";font-size:12px;}

/* ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œï¼šå°‘ã—ã ã‘ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆ */
@media (max-width:480px){
  .matrix td:last-child .actions .btn{
    font-size:10px;
    padding:2px 6px;
    gap:3px;
  }
}

/* ============= ä¸‹éƒ¨è©³ç´°ãƒ‘ãƒãƒ«ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰ ============= */
#detailPanel{display:none;border:1px solid #eee;border-radius:12px;background:#fff;margin:14px 0;padding:.8rem 1rem}
#detailPanel.active{display:block}
#detailPanel h3{margin:.2rem 0 .4rem;font-size:1.05rem}
#detailPanel .meta{color:#475569;font-size:.92rem;margin:.15rem 0}
/* === ã‹ã¶ã‚Šæ˜¯æ­£ãƒ»ä¸Šæ›¸ãCSSï¼ˆè²¼ã‚Šä»˜ã‘ã‚‹ã ã‘ï¼‰ === */

/* ã‚»ãƒ«ã‹ã‚‰ã¯ã¿å‡ºã™è¦ç´ ã‚’éš ã—ã¦éš£åˆ—ã¨é‡ãªã‚‰ãªã„ã‚ˆã†ã« */
.matrix td { overflow: hidden; }

/* å³ç«¯ã‚»ãƒ«ã¯å³å¯„ã›ã‚’å¼·åŒ– */
.matrix td:last-child { text-align: right; }

/* ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚³ãƒ³ãƒ†ãƒŠã¯ã‚»ãƒ«å¹…å†…ã§æŠ˜ã‚Šè¿”ã•ãªã„ï¼†ã¯ã¿å‡ºã•ãªã„ */
.matrix td:last-child .actions{
  max-width: 100%;
  overflow: hidden;
  justify-content: flex-end;
  align-items: center; /* é«˜ã•æƒãˆ */
  gap: 6px;
  /* ç”»é¢ãŒåºƒã„ã¨ãã¯æ¨ªä¸¦ã³ã€ç‹­ã„ã¨ãã¯ç¸¦ä¸¦ã³ */
  flex-direction: row;
  flex-wrap: nowrap;
  padding-right: 6px;
}

/* ãƒœã‚¿ãƒ³ã‚’ã•ã‚‰ã«ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆåŒ–ï¼ˆæ¨ªå¹…ã‚’å–ã‚‰ãªã„ï¼‰ */
.matrix td:last-child .actions .btn{
  font-size: 10px;        /* 11px â†’ 10px */
  padding: 2px 6px;       /* 3px 8px â†’ 2px 6px */
  gap: 3px;
  min-width: auto;
  max-width: 100%;
  border-radius: 7px;
}

/* æ–‡è¨€ãŒé•·ãã¦ã‚‚ç¸®ã‚€ã‚ˆã†ã«ï¼ˆä¸‡ä¸€ã®æ–‡å­—æŠ˜ã‚Šè¿”ã—å¯¾ç­–ï¼‰ */
.matrix td:last-child .actions .btn span,
.matrix td:last-child .actions .btn::before{
  white-space: nowrap;
}

/* ç‹­ã„ç”»é¢ã§ã¯è‡ªå‹•ã§ç¸¦ä¸¦ã³ï¼ˆè©°ã¾ã‚Šã‚’é˜²ãï¼‰ */
@media (max-width: 560px){
  .matrix td:last-child .actions{
    flex-direction: column;
    align-items: flex-end;
  }
  .matrix td:last-child .actions .btn{
    width: auto;          /* ç¸¦ä¸¦ã³æ™‚ã¯è‡ªç„¶å¹… */
    max-width: 100%;
  }
}

/* ã©ã†ã—ã¦ã‚‚é‡ãªã‚‹å ´åˆã¯æœ€çµ‚æ‰‹æ®µã¨ã—ã¦åˆ—å¹…å°‘ã—ã ã‘æ‹¡å¼µï¼ˆå¿…è¦ãªã‚‰è§£é™¤OKï¼‰ */
@media (min-width: 561px){
  .col-act { width: 6.8rem; }   /* æ—¢å®š 6.0rem å‰å¾Œ â†’ 6.8rem ã«åƒ…ã‹ã«æ‹¡å¼µ */
}

</style>

<!-- â–¼ åˆ†é‡ãƒ•ã‚£ãƒ«ã‚¿ -->
<div class="filter-bar" id="filterBar" aria-label="åˆ†é‡ãƒ•ã‚£ãƒ«ã‚¿">
  <button class="filter-btn fb-all" data-cat="ALL" aria-pressed="true"><span class="ficon">ğŸ—‚ï¸</span><span>ã™ã¹ã¦</span> <span class="count" id="cnt-all">(0)</span></button>
  <button class="filter-btn fb-edu" data-cat="æ•™è‚²"><span class="ficon">ğŸ“</span><span>æ•™è‚²</span> <span class="count" id="cnt-æ•™è‚²">(0)</span></button>
  <button class="filter-btn fb-wel" data-cat="ç¦ç¥‰"><span class="ficon">â¤ï¸</span><span>ç¦ç¥‰</span> <span class="count" id="cnt-ç¦ç¥‰">(0)</span></button>
  <button class="filter-btn fb-tour" data-cat="è¦³å…‰"><span class="ficon">ğŸï¸</span><span>è¦³å…‰</span> <span class="count" id="cnt-è¦³å…‰">(0)</span></button>
  <button class="filter-btn fb-oth" data-cat="ãã®ä»–"><span class="ficon">ğŸ“„</span><span>ãã®ä»–</span> <span class="count" id="cnt-ãã®ä»–">(0)</span></button>
</div>

<!-- â–¼ ãƒ†ãƒ¼ãƒ–ãƒ« -->
<div class="matrix-wrap">
  <table class="matrix" id="matrixTable">
    <colgroup>
      <col class="col-month">
      <col>
      <col class="col-cat">
      <col class="col-act">
    </colgroup>
    <thead>
      <tr>
        <th id="thMonth">
          <button id="sortMonth" class="sort-btn" data-order="asc" aria-sort="ascending" aria-label="å¹´æœˆã§ã‚½ãƒ¼ãƒˆï¼ˆæ˜‡é †ï¼‰">
            <span>å¹´æœˆ</span>
            <span class="sort-icon"><svg class="chev" viewBox="0 0 24 24"><path d="M7 10l5 5 5-5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg></span>
          </button>
        </th>
        <th>è¦æ—¨ãƒ»ä¼šæœŸ</th>
        <th id="thCat">
          <button id="sortCat" class="sort-btn" data-order="asc" aria-sort="none" aria-label="åˆ†é‡ã§ã‚½ãƒ¼ãƒˆï¼ˆæœªæŒ‡å®šï¼‰">
            <span>åˆ†é‡</span>
            <span class="sort-icon"><svg class="chev" viewBox="0 0 24 24"><path d="M7 10l5 5 5-5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg></span>
          </button>
        </th>
        <th>è©³ç´°</th>
      </tr>
    </thead>
    <tbody>
      {% assign rows = site.data.matrix.rows | default: empty %}
      {% for r in rows %}
        {% assign s = r.sakio %}
        {% assign cat = r.category | default: 'ãã®ä»–' %}
        {% assign c = cat | replace:'ã€€','' | replace:' ','' | downcase %}
        {% capture catkey %}{% if c contains 'æ•™' %}edu{% elsif c contains 'ç¦' %}wel{% elsif c contains 'è¦³' %}tour{% else %}oth{% endif %}{% endcapture %}
        {% capture catlabel %}{% if catkey == 'edu' %}æ•™è‚²{% elsif catkey == 'wel' %}ç¦ç¥‰{% elsif catkey == 'tour' %}è¦³å…‰{% else %}ãã®ä»–{% endif %}{% endcapture %}
        {% capture caticon %}{% if catkey == 'edu' %}ğŸ“{% elsif catkey == 'wel' %}â¤ï¸{% elsif catkey == 'tour' %}ğŸï¸{% else %}ğŸ“„{% endif %}{% endcapture %}
        {% capture catabbr %}{% if catkey == 'edu' %}æ•™{% elsif catkey == 'wel' %}ç¦{% elsif catkey == 'tour' %}è¦³{% else %}ä»–{% endif %}{% endcapture %}
        <tr class="row"
            data-cat="{{ catlabel }}"
            data-catkey="{{ catkey }}"
            data-month="{{ s.month | replace:'-','' | plus:0 }}"
            data-month-iso="{{ s.month }}"
            data-title="{{ s.text | escape }}"
            data-session="{{ s.session | escape }}"
            data-pdf="{{ s.pdf | relative_url }}"
            data-related='{{ r.related | jsonify }}'>
          <td>{{ s.month }}</td>
          <td>
            <div class="cell-title">{{ s.text }}</div>
            <div class="cell-session">{{ s.session }}</div>
          </td>
          <td>
            <span class="cat-pill cat-{{ catkey }}" title="{{ catlabel }}" aria-label="{{ catlabel }}">
              <span class="icon">{{ caticon }}</span>
              <span class="label">{{ catabbr }}</span>
            </span>
          </td>
          <td>
            <div class="actions">
              {% if s.pdf %}<a class="btn pdf-link" href="{{ s.pdf | relative_url }}" data-modal="pdf" data-title="{{ s.text }}">PDF</a>{% endif %}
              <a class="btn ghost detail-link" href="#">è©³ç´°</a>
            </div>
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- â–¼ ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼†ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ -->
<dialog id="detailModal" aria-label="è³ªå•ã®è©³ç´°">
  <div style="display:flex;justify-content:space-between;align-items:center;padding:.7rem .9rem;border-bottom:1px solid #eee">
    <strong id="detailTitle"></strong>
    <button id="closeDetail" class="btn" type="button">Ã—</button>
  </div>
  <div style="padding:.8rem .9rem .9rem;font-size:.95rem;line-height:1.6">
    <p class="meta"><strong>ä¼šæœŸ:</strong> <span id="detailSession"></span></p>
    <p class="meta"><strong>å¹´æœˆ:</strong> <span id="detailMonth"></span>ã€€<strong>åˆ†é‡:</strong> <span id="detailCat"></span></p>
    <div id="detailRelated"></div>
    <div id="detailPDF" style="margin-top:.6rem;"></div>
  </div>
</dialog>

<section id="detailPanel" aria-live="polite" style="display:none;">
  <h3 id="dpTitle"></h3>
  <p class="meta"><strong>ä¼šæœŸ:</strong> <span id="dpSession"></span></p>
  <p class="meta"><strong>å¹´æœˆ:</strong> <span id="dpMonth"></span>ã€€<strong>åˆ†é‡:</strong> <span id="dpCat"></span></p>
  <div id="dpRelated"></div>
  <div id="dpPDF" style="margin-top:.6rem;"></div>
</section>

{% raw %}
<script>
document.addEventListener('DOMContentLoaded',()=>{
  const table = document.getElementById('matrixTable');
  const tbody = table.querySelector('tbody');
  const allRows = Array.from(tbody.querySelectorAll('tr.row'));

  const thMonthBtn = document.getElementById('sortMonth');
  const thCatBtn   = document.getElementById('sortCat');

  const dlg = document.getElementById('detailModal');
  const dp  = document.getElementById('detailPanel');

  /* ===== ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ===== */
  function safeShowModal(){
    try{ if(dlg && typeof dlg.showModal === 'function'){ dlg.showModal(); return true; } }catch(_){}
    return false;
  }
  function closeViews(){
    try{ dlg?.close(); }catch(_){}
    if (dp) { dp.classList.remove('active'); dp.style.display='none'; }
  }
  document.getElementById('closeDetail')?.addEventListener('click',()=>{ closeViews(); rewriteHash({k:null}); });

  const CAT_ORDER = ['æ•™è‚²','ç¦ç¥‰','è¦³å…‰','ãã®ä»–'];

  /* ===== ãƒãƒƒã‚·ãƒ¥ (#cat=æ•™è‚²&k=...) ===== */
  function parseHash(){
    const h = (location.hash||'').replace(/^#/,'');
    const obj = {};
    if(!h) return obj;
    h.split('&').forEach(p=>{
      const i = p.indexOf('=');
      if(i === -1) return;
      const k = decodeURIComponent(p.slice(0,i));
      const v = decodeURIComponent(p.slice(i+1));
      obj[k] = v;
    });
    return obj;
  }
  function rewriteHash(upd){
    const cur = parseHash();
    const next = { ...cur, ...upd };
    Object.keys(next).forEach(k=>{ if(next[k]==null || next[k]==='') delete next[k]; });
    const h = Object.keys(next).map(k=>`${encodeURIComponent(k)}=${encodeURIComponent(next[k])}`).join('&');
    history.replaceState(null,'', h ? `#${h}` : location.pathname + location.search);
  }

  /* ===== keyç”Ÿæˆ ===== */
  function slugify(s){
    return String(s||'').toLowerCase()
      .replace(/\s+/g,'-')
      .replace(/[^\w\-ã-ã‚“ã‚¡-ãƒ³ä¸€-é¾¥]/g,'')
      .replace(/-+/g,'-')
      .replace(/^-+|-+$/g,'');
  }
  function keyOfRow(tr){
    return slugify(`${tr.dataset.cat}-${tr.dataset['monthIso']}-${tr.dataset.title}`);
  }

  /* ===== è©³ç´°ï¼šè¡Œãƒ»ãƒªãƒ³ã‚¯ ===== */
  allRows.forEach(tr=>{
    const key = keyOfRow(tr); tr.dataset.key = key;
    tr.querySelector('a.detail-link')?.addEventListener('click',(e)=>{
      e.preventDefault(); openDetail(tr); rewriteHash({k:key});
    });
  });
  tbody.addEventListener('click',(e)=>{
    const row = e.target.closest('tr.row'); if(!row) return;
    if(e.target.closest('a,button,[data-modal]')) return; // ãƒœã‚¿ãƒ³è‡ªä½“ã¯é€šå¸¸å‹•ä½œ
    const key = row.dataset.key || keyOfRow(row);
    openDetail(row); rewriteHash({k:key});
  });

  function openDetail(row){
    const title = row.dataset.title||'';
    const session = row.dataset.session||'';
    const month = row.dataset['monthIso']||'';
    const cat = row.dataset.cat||'';
    const rel = JSON.parse(row.dataset.related||'[]');
    const pdf = row.dataset.pdf||'';

    // ãƒ¢ãƒ¼ãƒ€ãƒ«
    document.getElementById('detailTitle').textContent = title;
    document.getElementById('detailSession').textContent = session;
    document.getElementById('detailMonth').textContent = month;
    document.getElementById('detailCat').textContent = cat;
    document.getElementById('detailRelated').innerHTML = rel.length
      ? '<strong>é¡ä¼¼è­°å“¡</strong><ul style="margin:.4rem 0 .2rem 1.1rem;">' + rel.map(x=>`<li>${x.name}ï¼ˆ${x.party}ï¼‰ï¼š${x.month}ï¼${x.topic}</li>`).join('') + '</ul>'
      : '<span class="muted">â€”</span>';
    document.getElementById('detailPDF').innerHTML = pdf
      ? `<a href="${pdf}" data-modal="pdf" class="btn">ğŸ“„ PDFã‚’é–‹ã</a> &nbsp;<a href="${pdf}" target="_blank" rel="noopener" class="btn">â†—ï¸ æ–°ã—ã„ã‚¿ãƒ–</a>`
      : '<span class="muted">PDFãªã—</span>';

    // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
    document.getElementById('dpTitle').textContent = title;
    document.getElementById('dpSession').textContent = session;
    document.getElementById('dpMonth').textContent = month;
    document.getElementById('dpCat').textContent = cat;
    document.getElementById('dpRelated').innerHTML = rel.length
      ? '<strong>é¡ä¼¼è­°å“¡</strong><ul style="margin:.2rem 0 .2rem 1.1rem;">' + rel.map(x=>`<li>${x.name}ï¼ˆ${x.party}ï¼‰ï¼š${x.month}ï¼${x.topic}</li>`).join('') + '</ul>'
      : '<span class="muted">â€”</span>';
    document.getElementById('dpPDF').innerHTML = pdf
      ? `<a href="${pdf}" data-modal="pdf" class="btn">ğŸ“„ PDFã‚’é–‹ã</a> &nbsp;<a href="${pdf}" target="_blank" rel="noopener" class="btn">â†—ï¸ æ–°ã—ã„ã‚¿ãƒ–</a>`
      : '<span class="muted">PDFãªã—</span>';

    closeViews();
    if(!safeShowModal()){
      dp.classList.add('active'); dp.style.display='block';
      dp.scrollIntoView({behavior:'smooth', block:'start'});
    }
  }

  /* ===== ä»¶æ•°ã‚«ã‚¦ãƒ³ãƒˆ ===== */
  const COUNTS = { 'ALL': allRows.length, 'æ•™è‚²':0, 'ç¦ç¥‰':0, 'è¦³å…‰':0, 'ãã®ä»–':0 };
  allRows.forEach(tr=>{
    const cat = tr.dataset.cat || 'ãã®ä»–';
    if(COUNTS[cat] != null) COUNTS[cat]++;
  });
  const ids = { 'ALL':'cnt-all', 'æ•™è‚²':'cnt-æ•™è‚²', 'ç¦ç¥‰':'cnt-ç¦ç¥‰', 'è¦³å…‰':'cnt-è¦³å…‰', 'ãã®ä»–':'cnt-ãã®ä»–' };
  Object.entries(ids).forEach(([k,id])=>{
    const el = document.getElementById(id);
    if(el) el.textContent = `(${COUNTS[k]||0})`;
  });

  /* ===== ãƒ•ã‚£ãƒ«ã‚¿ ===== */
  let currentFilter = 'ALL';
  const filterBar = document.getElementById('filterBar');
  filterBar.addEventListener('click',(e)=>{
    const b = e.target.closest('.filter-btn'); if(!b) return;
    setFilter(b.getAttribute('data-cat') || 'ALL');
  });
  function setFilter(cat){
    currentFilter = cat;
    // ãƒˆã‚°ãƒ«UI
    filterBar.querySelectorAll('.filter-btn').forEach(btn=>{
      btn.setAttribute('aria-pressed', btn.getAttribute('data-cat') === cat ? 'true' : 'false');
    });
    // è¡¨ç¤ºåˆ‡æ›¿
    allRows.forEach(tr=>{
      tr.style.display = (cat === 'ALL' || tr.dataset.cat === cat) ? '' : 'none';
    });
    // ãƒãƒƒã‚·ãƒ¥æ›´æ–°
    rewriteHash({cat: cat === 'ALL' ? null : cat});
  }

  /* ===== ã‚½ãƒ¼ãƒˆ ===== */
  let sortKey = 'month'; // 'month' | 'cat'
  function applySort(){
    const mOrder = thMonthBtn.dataset.order;   // asc|desc
    const cOrder = thCatBtn.dataset.order;     // asc|desc
    const rows = [...allRows];

    rows.sort((a,b)=>{
      const ma = +a.dataset.month, mb = +b.dataset.month;
      const ca = a.dataset.cat,    cb = b.dataset.cat;
      if(sortKey === 'month'){
        return mOrder === 'asc' ? (ma - mb) : (mb - ma);
      }else{
        const ai = CAT_ORDER.indexOf(ca)>=0 ? CAT_ORDER.indexOf(ca) : 99;
        const bi = CAT_ORDER.indexOf(cb)>=0 ? CAT_ORDER.indexOf(cb) : 99;
        if(ai !== bi) return cOrder === 'asc' ? (ai - bi) : (bi - ai);
        // åŒã‚«ãƒ†ã‚´ãƒªå†…ã¯å¹´æœˆ
        return mOrder === 'asc' ? (ma - mb) : (mb - ma);
      }
    });

    rows.forEach(r=>tbody.appendChild(r));
  }

  function updateAria(btn, order){
    btn.setAttribute('data-order', order);
    btn.setAttribute('aria-sort', order === 'asc' ? 'ascending' : 'descending');
    const labelBase = btn === thMonthBtn ? 'å¹´æœˆã§ã‚½ãƒ¼ãƒˆ' : 'åˆ†é‡ã§ã‚½ãƒ¼ãƒˆ';
    btn.setAttribute('aria-label', `${labelBase}ï¼ˆ${order === 'asc' ? 'æ˜‡é †' : 'é™é †'}ï¼‰`);
  }

  thMonthBtn.addEventListener('click', ()=>{
    if(sortKey !== 'month'){ sortKey = 'month'; }
    else { updateAria(thMonthBtn, thMonthBtn.dataset.order === 'asc' ? 'desc' : 'asc'); }
    applySort(); setFilter(currentFilter);
    // ä»–æ–¹ã®aria-sortã¯noneã«
    thCatBtn.setAttribute('aria-sort','none');
  });

  thCatBtn.addEventListener('click', ()=>{
    if(sortKey !== 'cat'){ sortKey = 'cat'; }
    else { updateAria(thCatBtn, thCatBtn.dataset.order === 'asc' ? 'desc' : 'asc'); }
    applySort(); setFilter(currentFilter);
    thMonthBtn.setAttribute('aria-sort', thMonthBtn.dataset.order === 'asc' ? 'ascending' : 'descending');
  });

  // åˆæœŸè¡¨ç¤ºï¼šã‚½ãƒ¼ãƒˆï¼†ãƒãƒƒã‚·ãƒ¥é©ç”¨
  applySort();

  function initFromHash(){
    const h = parseHash();
    if(h.cat){ setFilter(h.cat); } else { setFilter('ALL'); }
    if(h.k){
      const row = allRows.find(tr => (tr.dataset.key || keyOfRow(tr)) === h.k);
      if(row) openDetail(row);
    }
  }
  window.addEventListener('hashchange', initFromHash);
  initFromHash();
});
</script>
{% endraw %}
