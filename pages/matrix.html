---
layout: default
title: ä¸€èˆ¬è³ªå•ï¼ˆã‚«ãƒ†ã‚´ãƒªåˆ¥ãƒ»ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰
permalink: /pages/matrix.html
---

<h2 style="margin:0 0 10px;">ä¸€èˆ¬è³ªå•ï¼ˆã‚«ãƒ†ã‚´ãƒªåˆ¥ãƒ»ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰</h2>
<p class="muted" style="margin:6px 0 16px;">è¡Œã‚¿ãƒƒãƒ—ã§è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ«ã€‚ãƒ˜ãƒƒãƒ€ãƒ¼ã®çŸ¢å°ã‚¢ã‚¤ã‚³ãƒ³ã§æ˜‡é †/é™é †ã‚’åˆ‡æ›¿ã§ãã¾ã™ã€‚</p>

<style>
body, h1, h2, h3, p, td, th, button, a {
  font-family: "Noto Sans JP","Hiragino Sans","Yu Gothic UI","æ¸¸ã‚´ã‚·ãƒƒã‚¯ä½“","Meiryo",system-ui,sans-serif;
}
.matrix-wrap{overflow:auto;border:1px solid #eee;border-radius:12px;background:#fff}
table.matrix{width:100%;border-collapse:collapse;font-size:.95rem;table-layout:fixed}
.matrix th,.matrix td{padding:.5rem .6rem;border-bottom:1px solid #f1f5f9;vertical-align:top}
.matrix thead th{position:sticky;top:0;background:#fafafa;z-index:1;white-space:nowrap;user-select:none}

/* ãƒ›ãƒãƒ¼è¡Œ */
.matrix tbody tr:hover{background:#fcfcff}
.muted{color:#64748b}

/* åˆ—å¹…ï¼ˆè¦æ—¨ã‚’æœ€å¤§åŒ–ï¼‰ */
.col-month{width:5.6rem}
.col-cat{width:6.8rem}
.col-act{width:7.0rem}

/* åˆ†é‡è¡¨ç¤ºï¼šå°ã•ãªè‰²ãƒ‰ãƒƒãƒˆï¼‹çŸ­ãƒ©ãƒ™ãƒ« */
.cat-badge{display:inline-flex;align-items:center;gap:.42rem}
.dot{width:.58rem;height:.58rem;border-radius:50%}
.dot.edu{background:#3b82f6}.dot.wel{background:#ef476f}.dot.tour{background:#22c55e}.dot.oth{background:#94a3b8}

/* ãƒœã‚¿ãƒ³ï¼ˆå°å‹ãƒ”ãƒ«ï¼‰ */
.btn{display:inline-flex;align-items:center;gap:.3em;padding:.24rem .52rem;border:1px solid #d6d6dc;border-radius:999px;background:#fff;text-decoration:none;font-size:.82rem;line-height:1;white-space:nowrap}
.btn:hover{background:#f5f7ff}
.btn + .btn{margin-left:.3rem}
.cell-title{font-weight:700;line-height:1.35;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical}
.cell-session{font-size:.86rem;color:#64748b;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}

/* ã‚½ãƒ¼ãƒˆãƒœã‚¿ãƒ³ï¼ˆã‚¢ã‚¤ã‚³ãƒ³ä»˜ãï¼‰ */
.sort-btn{
  display:inline-flex;align-items:center;gap:.4rem;
  border:none;background:transparent;cursor:pointer;font:inherit;padding:.25rem .3rem;margin:-.25rem 0;
}
.sort-btn:focus{outline:3px solid #93c5fd;outline-offset:2px;border-radius:6px}
.sort-icon{
  width:14px;height:14px;display:inline-block;
}
.chev{
  transition:transform .15s ease, opacity .15s ease;
  opacity:.65;
}
[aria-sort="ascending"] .chev{transform:rotate(180deg)} /* ä¸Šå‘ãï¼æ˜‡é † */
[aria-sort="descending"] .chev{transform:rotate(0deg)}   /* ä¸‹å‘ãï¼é™é † */
.sort-btn:hover .chev{opacity:1}

/* SPå¾®èª¿æ•´ */
@media(max-width:840px){.col-month{width:5.2rem}.col-cat{width:6.2rem}.col-act{width:6.6rem}}
@media(max-width:480px){.col-month{width:4.9rem}.col-cat{width:5.8rem}.col-act{width:6.2rem}.cell-session{display:none}}
</style>

<div class="matrix-wrap">
  <table class="matrix" id="matrixTable">
    <colgroup>
      <col class="col-month"><col><!-- è¦æ—¨ï¼ˆåºƒã„ï¼‰ --><col class="col-cat"><col class="col-act">
    </colgroup>
    <thead>
      <tr>
        <!-- å¹´æœˆã‚½ãƒ¼ãƒˆ -->
        <th id="thMonth">
          <button id="sortMonth" class="sort-btn" data-order="asc" aria-sort="ascending" aria-label="å¹´æœˆã§ã‚½ãƒ¼ãƒˆï¼ˆç¾åœ¨ï¼šæ˜‡é †ï¼‰">
            <span>å¹´æœˆ</span>
            <span class="sort-icon" aria-hidden="true">
              <!-- ä¸‹çŸ¢å°ï¼ˆdescæ™‚ï¼‰ã‚’åŸºæœ¬ã«ã€æ˜‡é †ã§å›è»¢ -->
              <svg class="chev" viewBox="0 0 24 24"><path d="M7 10l5 5 5-5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
            </span>
          </button>
        </th>

        <th>è¦æ—¨ãƒ»ä¼šæœŸ</th>

        <!-- åˆ†é‡ã‚½ãƒ¼ãƒˆ -->
        <th id="thCat">
          <button id="sortCat" class="sort-btn" data-order="asc" aria-sort="none" aria-label="åˆ†é‡ã§ã‚½ãƒ¼ãƒˆï¼ˆç¾åœ¨ï¼šæœªæŒ‡å®šï¼‰">
            <span>åˆ†é‡</span>
            <span class="sort-icon" aria-hidden="true">
              <svg class="chev" viewBox="0 0 24 24"><path d="M7 10l5 5 5-5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
            </span>
          </button>
        </th>

        <th>è©³ç´°</th>
      </tr>
    </thead>
    <tbody>
      {% assign rows = site.data.matrix.rows | default: empty %}
      {% for r in rows %}
        {% assign s = r.sakio %}
        {% assign cat = r.category | default: 'ãã®ä»–' %}
        {% assign c = cat | replace:'ã€€','' | replace:' ','' | downcase %}
        {% capture catkey %}{% if c contains 'æ•™' %}edu{% elsif c contains 'ç¦' %}wel{% elsif c contains 'è¦³' %}tour{% else %}oth{% endif %}{% endcapture %}
        <tr class="row"
            data-cat="{{ cat }}"
            data-catkey="{{ catkey | strip }}"
            data-month="{{ s.month | replace:'-','' | plus:0 }}"
            data-month-iso="{{ s.month }}"
            data-title="{{ s.text | escape }}"
            data-session="{{ s.session | escape }}"
            data-pdf="{{ s.pdf | relative_url }}"
            data-related='{{ r.related | jsonify }}'>
          <td>{{ s.month }}</td>
          <td>
            <div class="cell-title">{{ s.text }}</div>
            <div class="cell-session">{{ s.session }}</div>
          </td>
          <td>
            <span class="cat-badge" title="{{ cat }}">
              <span class="dot {{ catkey | strip }}"></span>
              <span>
                {% if catkey == 'edu' %}æ•™è‚²{% elsif catkey == 'wel' %}ç¦ç¥‰{% elsif catkey == 'tour' %}è¦³å…‰{% else %}ãã®ä»–{% endif %}
              </span>
            </span>
          </td>
          <td>
            <div style="display:flex;flex-wrap:wrap;align-items:center;justify-content:flex-start;">
              {% if s.pdf %}
                <a class="btn pdf-link" href="{{ s.pdf | relative_url }}" data-modal="pdf" data-title="{{ s.text }}">PDF</a>
              {% endif %}
              <a class="btn ghost detail-link" href="#">è©³ç´°</a>
            </div>
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<dialog id="detailModal" aria-label="è³ªå•ã®è©³ç´°">
  <div style="display:flex;justify-content:space-between;align-items:center;padding:.7rem .9rem;border-bottom:1px solid #eee">
    <strong id="detailTitle"></strong>
    <button id="closeDetail" aria-label="é–‰ã˜ã‚‹" class="btn">Ã—</button>
  </div>
  <div style="padding:.8rem .9rem .9rem;font-size:.95rem;line-height:1.6">
    <p class="meta"><strong>ä¼šæœŸ:</strong> <span id="detailSession"></span></p>
    <p class="meta"><strong>å¹´æœˆ:</strong> <span id="detailMonth"></span>ã€€<strong>åˆ†é‡:</strong> <span id="detailCat"></span></p>
    <div id="detailRelated"></div>
    <div id="detailPDF" style="margin-top:.6rem;"></div>
  </div>
</dialog>

{% raw %}
<script>
document.addEventListener('DOMContentLoaded',()=>{
  const table=document.getElementById('matrixTable');
  const tbody=table.querySelector('tbody');
  const allRows=Array.from(tbody.querySelectorAll('tr.row'));

  const thMonthBtn=document.getElementById('sortMonth');
  const thCatBtn=document.getElementById('sortCat');
  const thMonth=document.getElementById('thMonth');
  const thCat=document.getElementById('thCat');

  const dlg=document.getElementById('detailModal');
  document.getElementById('closeDetail')?.addEventListener('click',()=>{ dlg.close(); history.replaceState(null,'',location.pathname+location.search); });

  const CAT_ORDER=['æ•™è‚²','ç¦ç¥‰','è¦³å…‰','ãã®ä»–'];

  // å…±æœ‰ãƒªãƒ³ã‚¯ç”¨ï¼šslugify & key
  function slugify(s){
    return String(s||'').toLowerCase()
      .replace(/\s+/g,'-')
      .replace(/[^\w\-ã-ã‚“ã‚¡-ãƒ³ä¸€-é¾¥]/g,'')
      .replace(/-+/g,'-')
      .replace(/^-+|-+$/g,'');
  }
  function keyOfRow(tr){
    return slugify(`${tr.dataset.cat}-${tr.dataset['monthIso']}-${tr.dataset.title}`);
  }

  // ã€Œè©³ç´°ã€ãƒªãƒ³ã‚¯â†’ #k=... & ãƒ¢ãƒ¼ãƒ€ãƒ«
  allRows.forEach(tr=>{
    const key = keyOfRow(tr);
    tr.dataset.key = key;
    const link = tr.querySelector('a.detail-link');
    if(link){
      link.href = `#k=${key}`;
      link.addEventListener('click',(e)=>{
        e.preventDefault();
        openDetail(tr);
        history.replaceState(null,'',`#k=${key}`);
      });
    }
  });

  // è¡Œæœ¬ä½“ã‚¯ãƒªãƒƒã‚¯ã§ã‚‚ãƒ¢ãƒ¼ãƒ€ãƒ«
  tbody.addEventListener('click',(e)=>{
    const row=e.target.closest('tr.row'); if(!row) return;
    if(e.target.closest('a,button,[data-modal]')) return;
    const key=row.dataset.key || keyOfRow(row);
    openDetail(row);
    history.replaceState(null,'',`#k=${key}`);
  });

  function openDetail(row){
    document.getElementById('detailTitle').textContent = row.dataset.title || '';
    document.getElementById('detailSession').textContent = row.dataset.session || '';
    document.getElementById('detailMonth').textContent = row.dataset['monthIso'] || '';
    document.getElementById('detailCat').textContent = row.dataset.cat || '';
    const rel = JSON.parse(row.dataset.related || '[]');
    document.getElementById('detailRelated').innerHTML = rel.length
      ? '<strong>é¡ä¼¼è­°å“¡</strong><ul style="margin:.4rem 0 .2rem 1.1rem;">' +
        rel.map(x=>`<li>${x.name}ï¼ˆ${x.party}ï¼‰ï¼š${x.month}ï¼${x.topic}</li>`).join('') +
        '</ul>' : '<span class="muted">â€”</span>';
    const pdf = row.dataset.pdf || '';
    document.getElementById('detailPDF').innerHTML = pdf
      ? `<a href="${pdf}" data-modal="pdf" class="btn">ğŸ“„ PDFã‚’é–‹ã</a>
         &nbsp;<a href="${pdf}" target="_blank" rel="noopener" class="btn ghost">â†—ï¸ æ–°ã—ã„ã‚¿ãƒ–</a>`
      : '<span class="muted">PDFãªã—</span>';
    dlg.showModal();
  }

  // === ã‚½ãƒ¼ãƒˆ ===
  let sortKey='month'; // åˆæœŸã¯å¹´æœˆ
  function applySort(){
    const mOrder=thMonthBtn.dataset.order;   // 'asc'|'desc'
    const cOrder=thCatBtn.dataset.order;
    const rows=[...allRows];
    rows.sort((a,b)=>{
      const ma=+a.dataset.month, mb=+b.dataset.month;
      const ca=a.dataset.cat,    cb=b.dataset.cat;
      if(sortKey==='month'){
        return mOrder==='asc' ? ma-mb : mb-ma;
      }else{ // cat
        const ai = CAT_ORDER.indexOf(ca)>=0?CAT_ORDER.indexOf(ca):99;
        const bi = CAT_ORDER.indexOf(cb)>=0?CAT_ORDER.indexOf(cb):99;
        if(ai!==bi) return cOrder==='asc' ? ai-bi : bi-ai;
        return mOrder==='asc' ? ma-mb : mb-ma; // åŒã‚«ãƒ†ã‚´ãƒªå†…ã¯å¹´æœˆã§
      }
    });
    rows.forEach(r=>tbody.appendChild(r));
    updateSortIcons();
  }

  function updateSortIcons(){
    // aria-sort ã®çŠ¶æ…‹æ›´æ–°ã¨ãƒ©ãƒ™ãƒ«æ–‡è¨€
    const mOrder = thMonthBtn.dataset.order;
    const cOrder = thCatBtn.dataset.order;
    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ none
    thMonthBtn.setAttribute('aria-sort', sortKey==='month' ? (mOrder==='asc'?'ascending':'descending') : 'none');
    thCatBtn.setAttribute('aria-sort',   sortKey==='cat'   ? (cOrder==='asc'?'ascending':'descending') : 'none');

    thMonthBtn.setAttribute('aria-label', `å¹´æœˆã§ã‚½ãƒ¼ãƒˆï¼ˆç¾åœ¨ï¼š${sortKey==='month' ? (mOrder==='asc'?'æ˜‡é †':'é™é †') : 'æœªæŒ‡å®š'}ï¼‰`);
    thCatBtn.setAttribute('aria-label',   `åˆ†é‡ã§ã‚½ãƒ¼ãƒˆï¼ˆç¾åœ¨ï¼š${sortKey==='cat'   ? (cOrder==='asc'?'æ˜‡é †':'é™é †') : 'æœªæŒ‡å®š'}ï¼‰`);
  }

  thMonthBtn.addEventListener('click',()=>{
    if(sortKey!=='month'){ sortKey='month'; } else {
      thMonthBtn.dataset.order = thMonthBtn.dataset.order==='asc'?'desc':'asc';
    }
    applySort();
  });

  thCatBtn.addEventListener('click',()=>{
    if(sortKey!=='cat'){ sortKey='cat'; } else {
      thCatBtn.dataset.order = thCatBtn.dataset.order==='asc'?'desc':'asc';
    }
    applySort();
  });

  applySort();

  // === ãƒ‡ã‚£ãƒ¼ãƒ—ãƒªãƒ³ã‚¯ï¼ˆ#k=...ï¼‰å¯¾å¿œ ===
  function tryOpenFromHash(){
    const m = location.hash.match(/#k=([\w\-ã-ã‚“ã‚¡-ãƒ³ä¸€-é¾¥]+)/);
    if(!m) return;
    const key = m[1];
    const row = allRows.find(tr => (tr.dataset.key||keyOfRow(tr)) === key);
    if(row) openDetail(row);
  }
  window.addEventListener('hashchange', tryOpenFromHash);
  tryOpenFromHash();
});
</script>
{% endraw %}
