---
layout: default
title: 一般質問マトリクス
---

<h1>💬 一般質問マトリクス</h1>
<p>行をタップすると詳細カードを開きます。PDFリンクはモーダルでその場表示（スマホでも見切れません）。</p>

<div class="toolbar">
  <div class="filters">
    <button class="fbtn active" data-filter="ALL">すべて</button>
    <button class="fbtn" data-filter="EDU">📘 教育</button>
    <button class="fbtn" data-filter="WEL">💗 福祉</button>
    <button class="fbtn" data-filter="TOUR">🏞 観光</button>
    <button class="fbtn" data-filter="OTHER">🧩 その他</button>
  </div>
  <input id="kw" type="search" placeholder="キーワード（年月・要旨・会期）" aria-label="キーワード検索">
</div>

<div class="matrix-wrap">
  <table class="matrix" id="matrixTable" aria-describedby="matrixHelp">
    <thead>
      <tr>
        <th class="sortable" data-key="month" data-order="desc">年月 ▼</th>
        <th>質問要旨／会期</th>
        <th class="sortable" data-key="cat" data-order="asc">分野 ▲</th>
        <th style="width:5.6rem;">資料</th>
      </tr>
    </thead>
    <tbody>
      {% for cat in site.data.matrix %}
        {% assign catname = cat[0] %}
        {% assign catlist = cat[1] %}
        {% assign c = catname | replace:'　','' | replace:' ',' ' | downcase %}
        {% capture catkey %}
          {% if c == '' %}
            OTHER
          {% elsif c contains '教' or c contains 'education' or c contains 'school' %}
            EDU
          {% elsif c contains '福' or c contains 'welfare' or c contains 'child' %}
            WEL
          {% elsif c contains '観' or c contains 'tour' or c contains 'sight' %}
            TOUR
          {% else %}
            OTHER
          {% endif %}
        {% endcapture %}
        {% assign catkey = catkey | strip | upcase %}
        {% for entry in catlist %}
          {% assign s = entry.sakio %}
          <tr class="row"
              data-title="{{ s.text | escape }}"
              data-session="{{ s.session | escape }}"
              data-month="{{ s.month | escape }}"
              data-monthnum="{{ s.month | replace:'-','' | plus:0 }}"
              data-category="{{ catname }}"
              data-catkey="{{ catkey }}"
              data-pdf="{{ s.pdf | relative_url }}"
              data-related='{{ entry.related | jsonify }}'>
            <td><span class="ym">{{ s.month }}</span></td>
            <td>
              <div class="q-title">{{ s.text }}</div>
              <div class="q-session">{{ s.session }}</div>
            </td>
            <td>
              <button type="button" class="chip cat" data-catkey="{{ catkey }}" data-cat="{{ catname }}">
                <span class="ico"></span><span class="catlabel">{{ catname }}</span>
              </button>
            </td>
            <td>
              {% if s.pdf %}
                <a href="{{ s.pdf | relative_url }}" class="open-pdf" data-title="{{ s.text }}">PDF</a>
              {% else %}
                <span class="muted">—</span>
              {% endif %}
            </td>
          </tr>
        {% endfor %}
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- 詳細カード -->
<dialog id="detailModal" aria-label="質問の詳細">
  <div class="modal-head">
    <strong id="detailTitle"></strong>
    <button id="closeDetail" aria-label="閉じる">×</button>
  </div>
  <div class="modal-body">
    <p class="meta"><strong>会期:</strong> <span id="detailSession"></span></p>
    <p class="meta"><strong>年月:</strong> <span id="detailMonth"></span>　<strong>分野:</strong> <span id="detailCat"></span></p>
    <div id="detailRelated"></div>
    <div id="detailPDF" style="margin-top:.6rem;"></div>
  </div>
</dialog>

<!-- PDFモーダル（スマホ見切れ防止） -->
<dialog id="pdfModal" aria-label="PDFを表示">
  <div class="modal-head">
    <strong id="pdfTitle">PDF</strong>
    <button id="closePdf" aria-label="閉じる">×</button>
  </div>
  <div class="pdf-body">
    <iframe id="pdfFrame" title="PDF表示" loading="lazy" referrerpolicy="no-referrer"></iframe>
  </div>
</dialog>

<style>
/* 基本スタイル */
.toolbar{display:flex;justify-content:space-between;align-items:center;gap:.6rem;margin:.7rem 0 1rem;flex-wrap:wrap}
.filters{display:flex;gap:.4rem;flex-wrap:wrap}
.fbtn{border:1px solid #e5e7eb;background:#fff;padding:.35rem .7rem;border-radius:999px;cursor:pointer;font-size:.9rem}
.fbtn.active{background:#eef5ff;border-color:#cfe2ff}
#kw{padding:.42rem .6rem;border:1px solid #e5e7eb;border-radius:9px;min-width:14rem;max-width:60vw;font-size:.92rem}
.matrix-wrap{overflow:auto;border:1px solid #eee;border-radius:12px}
table.matrix{width:100%;border-collapse:collapse;font-size:.93rem}
.matrix th,.matrix td{padding:.34rem .48rem;border-bottom:1px solid #f1f5f9;vertical-align:top}
.matrix thead th{position:sticky;top:0;background:#fafafa;z-index:1;font-weight:700}
.sortable{cursor:pointer}
.q-title{font-weight:700;line-height:1.3;margin:.05rem 0 .1rem}
.q-session{font-size:.82rem;color:#64748b}
.muted{color:#9ca3af}
.chip.cat{display:inline-flex;align-items:center;gap:.28rem;font-size:.82rem;font-weight:600;background:#eef5ff;color:#1d4ed8;border:1px solid #cfe2ff;border-radius:999px;padding:.16rem .42rem;cursor:pointer}
.chip.cat .ico{width:1em;text-align:center}

/* 詳細カード */
dialog{border:none;border-radius:12px;max-width:min(720px,96vw);width:96vw;padding:0}
dialog::backdrop{background:rgba(0,0,0,.35)}
.modal-head{display:flex;justify-content:space-between;align-items:center;padding:.7rem .9rem;border-bottom:1px solid #eee}
.modal-body{padding:.8rem .9rem .9rem;font-size:.95rem;line-height:1.6}
.modal-head button{border:none;background:#fff;font-size:1.1rem;border-radius:8px;padding:.3rem .5rem;cursor:pointer}

/* PDFモーダル */
#pdfModal{max-width:100vw;width:100vw;height:100vh;padding:0;margin:0;border-radius:0}
#pdfModal .pdf-body{height:calc(100vh - 48px - env(safe-area-inset-bottom));margin:0;padding:0}
#pdfFrame{width:100%;height:100%;border:0;display:block}
</style>

{% raw %}
<script>
document.addEventListener('DOMContentLoaded', () => {
  const ICONS = { EDU:'📘', WEL:'💗', TOUR:'🏞', OTHER:'🧩' };
  const tbody = document.querySelector('#matrixTable tbody');
  const fbtns = Array.from(document.querySelectorAll('.fbtn'));
  const kwEl = document.getElementById('kw');
  const dlgDetail = document.getElementById('detailModal');
  const pdfDlg = document.getElementById('pdfModal');
  const pdfFrame = document.getElementById('pdfFrame');
  const pdfTitle = document.getElementById('pdfTitle');
  const closePdf = document.getElementById('closePdf');

  // カテゴリアイコン付与
  tbody.querySelectorAll('tr.row').forEach(tr=>{
    const catKey = (tr.dataset.catkey||'OTHER').toUpperCase();
    const ico = tr.querySelector('.chip.cat .ico');
    if(ico) ico.textContent = ICONS[catKey] || '🧩';
  });

  // 全行リスト化
  const rows = Array.from(tbody.querySelectorAll('tr.row')).map(tr=>({
    tr,
    catKey:(tr.dataset.catkey||'OTHER').toUpperCase(),
    monthnum:Number(tr.dataset.monthnum||0),
    hay:(tr.dataset.title+tr.dataset.session+tr.dataset.month+tr.dataset.category).toLowerCase()
  }));

  // 初期ソート：年月降順
  rows.sort((a,b)=>b.monthnum - a.monthnum);
  rows.forEach(r=>tbody.appendChild(r.tr));

  // フィルタ関数
  function apply(){
    const active=fbtns.find(b=>b.classList.contains('active'));
    const fkey=active?active.dataset.filter:'ALL';
    const kw=(kwEl?.value||'').toLowerCase();
    rows.forEach(r=>{
      const okCat=(fkey==='ALL'||r.catKey===fkey);
      const okKw=(!kw||r.hay.includes(kw));
      r.tr.style.display=(okCat&&okKw)?'':'none';
    });
  }

  // ボタン
  fbtns.forEach(b=>b.addEventListener('click',()=>{
    fbtns.forEach(x=>x.classList.remove('active'));
    b.classList.add('active');
    apply();
  }));
  kwEl?.addEventListener('input',apply);

  // 行クリック→詳細
  document.addEventListener('click',e=>{
    const row=e.target.closest('tr.row');
    if(!row||e.target.closest('a.open-pdf'))return;
    document.getElementById('detailTitle').textContent=row.dataset.title;
    document.getElementById('detailSession').textContent=row.dataset.session;
    document.getElementById('detailMonth').textContent=row.dataset.month;
    document.getElementById('detailCat').textContent=row.dataset.category;
    const rel=JSON.parse(row.dataset.related||'[]');
    const relDiv=document.getElementById('detailRelated');
    relDiv.innerHTML=rel.length
      ?'<strong>類似議員</strong><ul>'+rel.map(x=>`<li>${x.name}（${x.party}）：${x.month}／${x.topic}</li>`).join('')+'</ul>'
      :'';
    document.getElementById('detailPDF').innerHTML=row.dataset.pdf
      ?`<a href="${row.dataset.pdf}" class="btn open-pdf" data-title="${row.dataset.title}">📄 PDFを開く</a>`
      :'<span class="muted">PDFなし</span>';
    dlgDetail.showModal();
  });
  document.getElementById('closeDetail')?.addEventListener('click',()=>dlgDetail.close());

  // PDFモーダル（公約と同形式）
  document.addEventListener('click',e=>{
    const a=e.target.closest('a.open-pdf');
    if(!a)return;
    e.preventDefault();
    pdfTitle.textContent=a.dataset.title||'PDF';
    pdfFrame.src=a.href;
    pdfDlg.showModal();
  });
  closePdf.addEventListener('click',()=>{
    pdfFrame.src='about:blank';
    pdfDlg.close();
  });

  apply();
});
</script>
{% endraw %}
