---
layout: default
title: 一般質問マトリクス
---

<h1>💬 一般質問マトリクス</h1>
<p>行をタップすると詳細カードを開きます。PDFリンクはモーダルでその場表示（スマホでも見切れません）。</p>

<div class="toolbar">
  <div class="filters">
    <!-- 比較はキーで行う（表記揺れ対策） -->
    <button class="fbtn active" data-filter="ALL">すべて</button>
    <button class="fbtn" data-filter="EDU">📘 教育</button>
    <button class="fbtn" data-filter="WEL">💗 福祉</button>
    <button class="fbtn" data-filter="TOUR">🏞 観光</button>
    <button class="fbtn" data-filter="OTHER">🧩 その他</button>
  </div>
  <input id="kw" type="search" placeholder="キーワード（年月・要旨・会期）" aria-label="キーワード検索">
</div>

<div class="matrix-wrap">
  <table class="matrix" id="matrixTable" aria-describedby="matrixHelp">
    <thead>
      <tr>
        <th id="th-month" class="sortable" data-key="month" data-order="desc" title="クリックで並び替え">年月 ▼</th>
        <th>質問要旨／会期</th>
        <th id="th-cat" class="sortable" data-key="cat" data-order="asc" title="クリックで並び替え">分野 ▲</th>
        <th style="width:5.6rem;">資料</th>
      </tr>
    </thead>
    <tbody>
      {%- assign data = site.data.matrix -%}
      {%- assign rows = "" | split: "" -%}
      {%- for pair in data -%}
        {%- assign cat = pair[0] -%}
        {%- for item in pair[1] -%}
          {%- assign r = item.sakio -%}
          {%- assign r = r | merge: {"__cat__": cat, "related": item.related} -%}
          {%- assign rows = rows | push: r -%}
        {%- endfor -%}
      {%- endfor -%}
      {%- assign sorted = rows | sort: "month" | reverse -%}

      {%- for r in sorted -%}
      <tr class="row"
          data-title="{{ r.text | escape }}"
          data-session="{{ r.session | escape }}"
          data-month="{{ r.month | escape }}"
          data-monthnum="{{ r.month | replace:'-','' | plus:0 }}"
          data-category="{{ r.__cat__ | strip | escape }}"
          data-pdf="{{ r.pdf | relative_url }}"
          data-related='{{ r.related | jsonify }}'>
        <td><span class="ym">{{ r.month }}</span></td>
        <td>
          <div class="q-title" title="{{ r.text | escape }}">{{ r.text }}</div>
          <div class="q-session">{{ r.session }}</div>
        </td>
        <td>
          <button type="button" class="chip cat" data-cat="{{ r.__cat__ | strip }}">
            <span class="ico"></span><span class="catlabel">{{ r.__cat__ | strip }}</span>
          </button>
        </td>
        <td>
          {%- if r.pdf -%}
            <a href="{{ r.pdf | relative_url }}" class="open-pdf" data-title="{{ r.text | escape }}">PDF</a>
          {%- else -%}
            <span class="muted">—</span>
          {%- endif -%}
        </td>
      </tr>
      {%- endfor -%}
    </tbody>
  </table>
  <p id="matrixHelp" class="visually-hidden">ヘッダーの「年月」「分野」をクリックすると並び替えできます。</p>
</div>

<!-- 詳細カード -->
<dialog id="detailModal" aria-label="質問の詳細">
  <div class="modal-head">
    <strong id="detailTitle"></strong>
    <button id="closeDetail" aria-label="閉じる">×</button>
  </div>
  <div class="modal-body">
    <p class="meta"><strong>会期:</strong> <span id="detailSession"></span></p>
    <p class="meta"><strong>年月:</strong> <span id="detailMonth"></span>　<strong>分野:</strong> <span id="detailCat"></span></p>
    <div id="detailRelated"></div>
    <div id="detailPDF" style="margin-top:.6rem;"></div>
  </div>
</dialog>

<!-- PDFモーダル（iOSで見切れない全画面近く表示） -->
<dialog id="pdfModal" aria-label="PDFを表示">
  <div class="modal-head">
    <strong id="pdfTitle">PDF</strong>
    <button id="closePdf" aria-label="閉じる">×</button>
  </div>
  <div class="pdf-body">
    <iframe id="pdfFrame" title="PDF表示" loading="lazy" referrerpolicy="no-referrer"></iframe>
  </div>
</dialog>

<style>
/* ===== ツールバー ===== */
.toolbar{display:flex;justify-content:space-between;align-items:center;gap:.6rem;margin:.7rem 0 1rem;flex-wrap:wrap}
.filters{display:flex;gap:.4rem;flex-wrap:wrap}
.fbtn{border:1px solid #e5e7eb;background:#fff;padding:.35rem .7rem;border-radius:999px;cursor:pointer;font-size:.9rem}
.fbtn.active{background:#eef5ff;border-color:#cfe2ff}
#kw{padding:.42rem .6rem;border:1px solid #e5e7eb;border-radius:9px;min-width:14rem;max-width:60vw;font-size:.92rem}

/* ===== テーブル：高密度 ===== */
.matrix-wrap{overflow:auto;border:1px solid #eee;border-radius:12px}
table.matrix{width:100%;border-collapse:collapse;font-size:.93rem}
.matrix th,.matrix td{padding:.34rem .48rem;border-bottom:1px solid #f1f5f9;vertical-align:top}
.matrix thead th{position:sticky;top:0;background:#fafafa;z-index:1;font-weight:700}
.ym{font-size:.86rem;color:#475569;white-space:nowrap}
.q-title{font-weight:700;line-height:1.3;margin:.05rem 0 .1rem;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}
.q-session{font-size:.82rem;color:#64748b}
.muted{color:#9ca3af}
.sortable{cursor:pointer;user-select:none}
.sortable:focus{outline:2px solid #cfe2ff;border-radius:6px}

/* 分野チップ（小さめ） */
.chip.cat{display:inline-flex;align-items:center;gap:.28rem;font-size:.82rem;font-weight:600;background:#eef5ff;color:#1d4ed8;border:1px solid #cfe2ff;border-radius:999px;padding:.16rem .42rem;cursor:pointer}
.chip.cat .ico{width:1em;display:inline-block;text-align:center}

/* スマホ：さらに圧縮＆会期は表では非表示（詳細で見る） */
@media(max-width:720px){
  .matrix th,.matrix td{padding:.26rem .38rem}
  .q-title{font-size:.94rem}
  .q-session{display:none}
  .chip.cat{font-size:.8rem;padding:.14rem .38rem}
  .matrix th:nth-child(1), .matrix td:nth-child(1){width:5.8rem}
  .matrix th:nth-child(3), .matrix td:nth-child(3){width:6.1rem}
  .matrix th:nth-child(4), .matrix td:nth-child(4){width:4.8rem}
}

/* ===== モーダル共通 ===== */
dialog{border:none;border-radius:12px;max-width:min(720px,96vw);width:96vw;padding:0}
dialog::backdrop{background:rgba(0,0,0,.35)}
.modal-head{display:flex;justify-content:space-between;align-items:center;padding:.7rem .9rem;border-bottom:1px solid #eee}
.modal-head strong{font-size:1rem}
.modal-head button{border:none;background:#fff;font-size:1.1rem;line-height:1;border-radius:8px;padding:.3rem .5rem;cursor:pointer}
.modal-body{padding:.8rem .9rem .9rem;font-size:.95rem;line-height:1.6}
.modal-body .meta{margin:.2rem 0}

/* ===== PDFモーダル：iOS見切れ対策（dvh） ===== */
#pdfModal{max-width:100vw;width:100vw;height:100dvh}
#pdfModal .pdf-body{height:calc(100dvh - 48px)}
#pdfFrame{width:100%;height:100%;border:0}
@supports not (height: 100dvh) {
  #pdfModal{height:96vh}
  #pdfModal .pdf-body{height:calc(96vh - 48px)}
}
.visually-hidden{position:absolute!important;height:1px;width:1px;overflow:hidden;clip:rect(1px,1px,1px,1px);white-space:nowrap}
</style>

{% raw %}
<script>
document.addEventListener('DOMContentLoaded', () => {

  /* ====== アイコン・カテゴリ判定 ====== */
  const ICONS = { 教育:'📘', 福祉:'💗', 観光:'🏞', その他:'🧩' };

  // 分野チップにアイコンを挿入
  document.querySelectorAll('.chip.cat').forEach(el=>{
    const cat = (el.dataset.cat || '').trim();
    const ico = el.querySelector('.ico');
    if(ico) ico.textContent = ICONS[cat] || '🧩';
  });

  /* ====== フィルタリング ====== */
  function applyFilter(){
    const active = document.querySelector('.fbtn.active');
    const f = active ? active.dataset.filter : 'all';
    const kw = (document.getElementById('kw').value || '').toLowerCase();
    document.querySelectorAll('tbody tr.row').forEach(r=>{
      const cat = (r.dataset.category || '').trim();
      const hay = (r.dataset.title + ' ' + r.dataset.session + ' ' + r.dataset.month + ' ' + cat).toLowerCase();
      const okC = (f==='all' || cat===f);
      const okK = (!kw || hay.includes(kw));
      r.style.display = (okC && okK)? '' : 'none';
    });
  }

  // フィルタボタン
  document.querySelectorAll('.fbtn').forEach(b=>{
    b.addEventListener('click',()=>{
      document.querySelectorAll('.fbtn').forEach(x=>x.classList.remove('active'));
      b.classList.add('active');
      applyFilter();
    });
  });

  // 分野チップクリックでも同様の動作
  document.addEventListener('click',e=>{
    const chip=e.target.closest('.chip.cat');
    if(!chip)return;
    const cat=chip.dataset.cat;
    const btn=[...document.querySelectorAll('.fbtn')].find(x=>x.dataset.filter===cat);
    if(btn)btn.click();
  });

  // 検索欄
  document.getElementById('kw').addEventListener('input',applyFilter);

  /* ====== 詳細カード ====== */
  const dlgDetail=document.getElementById('detailModal');
  document.addEventListener('click',(e)=>{
    const row=e.target.closest('tr.row');
    if(!row)return;
    if(e.target.closest('a.open-pdf'))return;

    document.getElementById('detailTitle').textContent=row.dataset.title;
    document.getElementById('detailSession').textContent=row.dataset.session;
    document.getElementById('detailMonth').textContent=row.dataset.month;
    document.getElementById('detailCat').textContent=row.dataset.category;

    const rel=JSON.parse(row.dataset.related||'[]');
    const relDiv=document.getElementById('detailRelated');
    relDiv.innerHTML=rel.length
      ?'<strong>類似議員</strong><ul style="margin:.4rem 0 .2rem 1.1rem;">'
        +rel.map(x=>`<li>${x.name}（${x.party}）：${x.month}／${x.topic}</li>`).join('')
        +'</ul>'
      :'';

    const pdf=row.dataset.pdf;
    document.getElementById('detailPDF').innerHTML=pdf
      ?`<a href="${pdf}" class="btn open-pdf" data-title="${row.dataset.title}">📄 PDFを開く</a>`
      :'<span class="muted">PDFなし</span>';

    dlgDetail.showModal();
  });

  document.getElementById('closeDetail').addEventListener('click',()=>dlgDetail.close());

  /* ====== PDFモーダル（見切れ防止） ====== */
  const pdfDlg=document.createElement('dialog');
  pdfDlg.id='pdfModal';
  pdfDlg.innerHTML=`
    <div style="display:flex;justify-content:space-between;align-items:center;padding:.4rem .6rem;background:#f1f5f9;">
      <strong id="pdfTitle"></strong>
      <button id="closePdf" style="font-size:1.3rem;">×</button>
    </div>
    <iframe id="pdfFrame" src="about:blank" style="width:100%;height:85vh;border:none;"></iframe>
  `;
  document.body.appendChild(pdfDlg);

  document.addEventListener('click',(e)=>{
    const a=e.target.closest('a.open-pdf');
    if(!a)return;
    e.preventDefault();
    const src=a.getAttribute('href');
    document.getElementById('pdfFrame').src=src;
    document.getElementById('pdfTitle').textContent=a.dataset.title||'PDF';
    pdfDlg.showModal();
  });

  document.getElementById('closePdf').addEventListener('click',()=>{
    document.getElementById('pdfFrame').src='about:blank';
    pdfDlg.close();
  });

  applyFilter(); // 初期化
});
</script>
{% endraw %}


