---
layout: default
title: ä¸€èˆ¬è³ªå•ï¼ˆã‚«ãƒ†ã‚´ãƒªåˆ¥ãƒ»ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰
permalink: /pages/matrix.html
---

<h2 style="margin:0 0 10px;">ä¸€èˆ¬è³ªå•ï¼ˆã‚«ãƒ†ã‚´ãƒªåˆ¥ãƒ»ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰</h2>
<p class="muted" style="margin:6px 0 16px;">è¡Œã‚¿ãƒƒãƒ—ã§è©³ç´°ã€‚ç’°å¢ƒã«ã‚ˆã‚Šãƒ¢ãƒ¼ãƒ€ãƒ« or ä¸‹éƒ¨ãƒ‘ãƒãƒ«ãŒé–‹ãã¾ã™ã€‚ä¸Šéƒ¨ãƒœã‚¿ãƒ³ã§åˆ†é‡ãƒ•ã‚£ãƒ«ã‚¿ã€ãƒ˜ãƒƒãƒ€ãƒ¼çŸ¢å°ã§æ˜‡é™åˆ‡æ›¿ã€‚</p>

<style>
body, h1, h2, h3, p, td, th, button, a {
  font-family: "Noto Sans JP","Hiragino Sans","Yu Gothic UI","æ¸¸ã‚´ã‚·ãƒƒã‚¯ä½“","Meiryo",system-ui,sans-serif;
}
.matrix-wrap{overflow:auto;border:1px solid #eee;border-radius:12px;background:#fff}
table.matrix{width:100%;border-collapse:collapse;font-size:.95rem;table-layout:fixed}
.matrix th,.matrix td{padding:.5rem .6rem;border-bottom:1px solid #f1f5f9;vertical-align:top}
.matrix thead th{position:sticky;top:0;background:#fafafa;z-index:1;white-space:nowrap;user-select:none}
.matrix tbody tr:hover{background:#fcfcff}
.muted{color:#64748b}

/* åˆ—å¹…ï¼šè¦æ—¨ã‚’åºƒãã€åˆ†é‡ã¯â€œåŠåˆ†å¹…â€ã¸ã‚¹ãƒªãƒ åŒ– */
.col-month{width:5.0rem}
.col-cat{width:3.0rem}   /* â† ã“ã“ã‚’ç´„åŠåˆ†ã« */
.col-act{width:6.2rem}

/* è¦æ—¨è¡¨ç¤º */
.cell-title{font-weight:700;line-height:1.35;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical}
.cell-session{font-size:.86rem;color:#64748b;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}

/* ã‚½ãƒ¼ãƒˆãƒœã‚¿ãƒ³ï¼ˆã‚¢ã‚¤ã‚³ãƒ³ä»˜ãï¼‰ */
.sort-btn{
  display:inline-flex;align-items:center;gap:.4rem;
  border:none;background:transparent;cursor:pointer;font:inherit;padding:.25rem .3rem;margin:-.25rem 0;
}
.sort-btn:focus{outline:3px solid #93c5fd;outline-offset:2px;border-radius:6px}
.sort-icon{width:14px;height:14px;display:inline-block}
.chev{transition:transform .15s ease, opacity .15s ease;opacity:.65}
[aria-sort="ascending"] .chev{transform:rotate(180deg)}
[aria-sort="descending"] .chev{transform:rotate(0deg)}
.sort-btn:hover .chev{opacity:1}

/* ãƒ•ã‚£ãƒ«ã‚¿ãƒœã‚¿ãƒ³è¡Œï¼ˆã‚¢ã‚¤ã‚³ãƒ³ï¼‹è‰²ï¼‹ä»¶æ•°ï¼‰ */
.filter-bar{display:flex;flex-wrap:wrap;gap:8px;align-items:center;margin:10px 0 12px;}
.filter-btn{
  display:inline-flex;align-items:center;gap:.45em;
  padding:.42rem .78rem;border:1px solid #d6d6dc;border-radius:999px;background:#fff;cursor:pointer;
  font-size:.86rem;line-height:1;text-decoration:none;font-weight:700;
}
.filter-btn[aria-pressed="true"]{background:#eef2ff;border-color:#c7d2fe}
.count{color:#64748b;font-variant-numeric:tabular-nums;font-weight:600}
.ficon{font-size:1rem;line-height:1}
.fb-edu .ficon{color:#3b82f6}
.fb-wel .ficon{color:#ef476f}
.fb-tour .ficon{color:#22c55e}
.fb-oth .ficon{color:#94a3b8}

/* åˆ†é‡ãƒ”ãƒ«ï¼ˆç¸¦ã‚¢ã‚¤ã‚³ãƒ³ï¼‹1æ–‡å­—ãƒ©ãƒ™ãƒ«ï¼‰â€” ã‚¹ãƒªãƒ åŒ– */
.cat-pill{
  display:inline-flex;flex-direction:column;align-items:center;justify-content:center;gap:.12rem;
  padding:.28rem .3rem;border-radius:9px;font-weight:800;color:#fff;min-width:2.6rem;  /* â† æœ€å°å¹…ã‚’å°ã•ã */
}
.cat-pill .icon{font-size:.95rem;line-height:1}
.cat-pill .label{font-size:.72rem;line-height:1}   /* â† 1æ–‡å­—ãƒ©ãƒ™ãƒ« */
.cat-edu{background:#3b82f6}   /* æ•™è‚²ï¼šé’ */
.cat-wel{background:#ef476f}   /* ç¦ç¥‰ï¼šãƒ”ãƒ³ã‚¯/èµ¤ */
.cat-tour{background:#22c55e}  /* è¦³å…‰ï¼šç·‘ */
.cat-oth{background:#94a3b8}   /* ãã®ä»–ï¼šã‚°ãƒ¬ãƒ¼ */

/* æ“ä½œãƒœã‚¿ãƒ³ */
.btn{display:inline-flex;align-items:center;gap:.3em;padding:.24rem .52rem;border:1px solid #d6d6dc;border-radius:999px;background:#fff;text-decoration:none;font-size:.82rem;line-height:1;white-space:nowrap}
.btn:hover{background:#f5f7ff}
.btn + .btn{margin-left:.3rem}

/* ä¸‹éƒ¨è©³ç´°ãƒ‘ãƒãƒ«ï¼ˆãƒ¢ãƒ¼ãƒ€ãƒ«éå¯¾å¿œå‘ã‘ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰ */
#detailPanel{display:none;border:1px solid #eee;border-radius:12px;background:#fff;margin:14px 0;padding:.8rem 1rem}
#detailPanel.active{display:block}
#detailPanel h3{margin:.2rem 0 .4rem;font-size:1.05rem}
#detailPanel .meta{color:#475569;font-size:.92rem;margin:.15rem 0}

@media(max-width:840px){.col-month{width:4.8rem}.col-cat{width:2.9rem}.col-act{width:6.0rem}}
@media(max-width:480px){.col-month{width:4.6rem}.col-cat{width:2.8rem}.col-act{width:5.8rem}.cell-session{display:none}}
/* === å³ç«¯ã€ŒPDFï¼è©³ç´°ã€ãƒœã‚¿ãƒ³ã‚’å³å¯„ã›ï¼†é«˜ã•æƒãˆï¼ˆä¸Šæ›¸ãCSSï¼‰ === */
.matrix td:last-child { text-align: right; }

/* æ—¢å­˜ã® inline-style(justify-content:flex-start) ã‚’å¼·åˆ¶ä¸Šæ›¸ã */
.matrix td:last-child > div {
  display: flex;
  justify-content: flex-end !important; /* â† å³å¯„ã›ã«å›ºå®š */
  align-items: center;
  gap: .5rem;
  min-height: 32px; /* è¡Œå†…ã§ã®ç¸¦ä½ç½®ã‚’å®‰å®š */
}

/* ãƒœã‚¿ãƒ³ã®é«˜ã•ã¨å†…å´ä½™ç™½ã‚’çµ±ä¸€ï¼ˆå¾®å¦™ãªã‚ºãƒ¬è§£æ¶ˆï¼‰ */
.matrix .btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  min-height: 32px;
  line-height: 1;
  padding: .3rem .7rem;
  vertical-align: middle;
}
/* === ä¸€èˆ¬è³ªå•ï¼šå³ç«¯ã®ã€ŒPDFï¼è©³ç´°ã€ã‚’ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆã«äºŒåˆ†å‰²é…ç½® === */
/* ã‚³ãƒ³ãƒ†ãƒŠã‚’ã‚°ãƒªãƒƒãƒ‰åŒ–ã—ã¦ã€æ¨ª 2 åˆ†å‰²ï¼ˆåŠåˆ†ãšã¤ï¼‰ */
.matrix td:last-child > div{
  display: grid !important;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 6px;
  justify-content: stretch !important; /* å³å¯„ã›ä¸Šæ›¸ãè§£é™¤ã—ã€ã‚»ãƒ«ã„ã£ã±ã„ã«é…ç½® */
  align-items: center;
  min-height: 0;
  padding-left: 6px; /* ã»ã‚“ã®å°‘ã—ã ã‘ä½™ç™½ */
}

/* ãƒœã‚¿ãƒ³è‡ªä½“ã‚’å°å‹åŒ–ï¼ˆé«˜ã•ï¼†ä½™ç™½ã‚’æŠ‘ãˆã‚‹ï¼‰ */
.matrix td:last-child .btn{
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 100%;            /* å„ã‚»ãƒ«ã‚’ã„ã£ã±ã„ã« */
  min-height: 28px;       /* æ—¢å­˜ 32px â†’ 28px ã« */
  font-size: .78rem;      /* å°‘ã—å°ã•ã */
  line-height: 1;
  padding: .28rem .5rem;  /* æ¨ªå¹…ã‚’å–ã‚Šéããªã„ã‚ˆã†èª¿æ•´ */
  border-radius: 12px;
}

/* ãã‚Œã£ã½ã„ã‚¢ã‚¤ã‚³ãƒ³ï¼ˆä»»æ„ã€‚ä¸è¦ãªã‚‰ã“ã®2è¡Œã¯æ¶ˆã—ã¦ãã ã•ã„ï¼‰ */
.matrix td:last-child .btn.pdf-link::before { content: "ğŸ“„"; margin-right: .3em; }
.matrix td:last-child .btn.ghost::before    { content: "ğŸ”"; margin-right: .3em; }

/* ç”»é¢ãŒç‹­ã„ã¨ãã¯è‡ªå‹•ã§ã€Œç¸¦äºŒæ®µã€(å„ãƒœã‚¿ãƒ³ãŒåŠåˆ†ã®é«˜ã•æ„Ÿ) ã«åˆ‡æ›¿ */
@media (max-width: 420px){
  .matrix td:last-child > div{
    grid-template-columns: 1fr;           /* 1åˆ—åŒ–ã—ã¦ç¸¦ä¸¦ã³ */
    grid-auto-rows: minmax(28px, auto);   /* ãã‚…ã£ã¨ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆã« */
  }
}

/* ç‰‡æ–¹ã—ã‹ç„¡ã„è¡Œã§ã‚‚ãƒœã‚¿ãƒ³å¹…ãŒå¤§ãããªã‚Šã™ããªã„ã‚ˆã†ã€æœ€å¤§å¹…ã‚’è»½ãåˆ¶é™ï¼ˆä»»æ„ï¼‰ */
.matrix td:last-child .btn{ max-width: 120px; margin-left: auto; }
/* === ä¸€èˆ¬è³ªå•ï¼šå³ç«¯ã€ŒPDFï¼è©³ç´°ã€ã‚’ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆãª2åˆ†å‰²ã«ï¼ˆç¢ºå®Ÿã«ä¸Šæ›¸ãç‰ˆï¼‰ === */

/* ã‚»ãƒ«å³ç«¯ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’ãƒ•ãƒ¬ãƒƒã‚¯ã‚¹ã«ã—ã¦æŠ˜è¿”ã—2åˆ†å‰² */
.matrix td:last-child > div{
  display: flex !important;            /* â† inline ã® display:flex ã‚’ä½¿ã„ã¤ã¤ */
  flex-wrap: wrap;                      /* 2åˆ†å‰²ã™ã‚‹ãŸã‚ã«æŠ˜è¿”ã—ON */
  justify-content: flex-end !important; /* å³ç«¯ã«å¯„ã›ã‚‹ï¼ˆå‰ãƒ«ãƒ¼ãƒ«ã‚’ä¸Šæ›¸ãï¼‰ */
  align-items: center;
  gap: 6px;
  padding-left: 6px;
  min-height: 0;
  text-align: right;                    /* ã‚»ãƒ«å†…ã‚‚å³å¯„ã› */
}

/* ãƒœã‚¿ãƒ³ã‚’â€œæ¨ªã«åŠåˆ†â€ãšã¤é…ç½®ï¼ˆè¡Œå¹…ã®50%âˆ’éš™é–“ï¼‰ */
.matrix td:last-child .btn{
  flex: 0 0 calc(50% - 6px);  /* â† ã“ã“ã§æ¨ª2åˆ†å‰² */
  width: auto;                /* æ˜ç¤ºå¹…ã¯ä¸è¦ */
  max-width: 160px;           /* ä¼¸ã³ã™ãé˜²æ­¢ï¼ˆèª¿æ•´å¯ï¼‰ */
  min-height: 28px;           /* ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆé«˜ã• */
  font-size: .78rem;          /* æ–‡å­—ã‚‚å°‘ã—å°ã•ã */
  line-height: 1;
  padding: .26rem .5rem;
  border-radius: 12px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

/* ç‰‡æ–¹ã—ã‹ç„¡ã„è¡Œï¼ˆPDFã ã‘ or è©³ç´°ã ã‘ï¼‰ã¯è‡ªç„¶å¹…ã« */
.matrix td:last-child .btn:only-child{
  flex: 0 0 auto;
  max-width: none;
}

/* ã‚¢ã‚¤ã‚³ãƒ³ï¼ˆä»»æ„ï¼šä¸è¦ãªã‚‰æ¶ˆã—ã¦ãã ã•ã„ï¼‰ */
.matrix td:last-child .btn.pdf-link::before { content: "ğŸ“„"; margin-right: .3em; }
.matrix td:last-child .btn.ghost::before    { content: "ğŸ”"; margin-right: .3em; }

/* ç‹­ã„ç”»é¢ã§ã¯è‡ªå‹•ã§â€œç¸¦ã«åŠåˆ†ãšã¤â€ï¼ˆ=ä¸Šä¸‹2æ®µï¼‰ */
@media (max-width: 420px){
  .matrix td:last-child .btn{
    flex: 1 0 100%;   /* 1åˆ—åŒ–ã—ã¦ç¸¦ä¸¦ã³ */
    max-width: none;
  }
}

</style>

<!-- â–¼ åˆ†é‡ãƒ•ã‚£ãƒ«ã‚¿ï¼ˆã‚¢ã‚¤ã‚³ãƒ³ï¼‹è‰²ã€ä»¶æ•°è¡¨ç¤ºã‚ã‚Šï¼‰ -->
<div class="filter-bar" id="filterBar" aria-label="åˆ†é‡ãƒ•ã‚£ãƒ«ã‚¿">
  <button class="filter-btn fb-all" data-cat="ALL" aria-pressed="true"><span class="ficon">ğŸ—‚ï¸</span><span>ã™ã¹ã¦</span> <span class="count" id="cnt-all">(0)</span></button>
  <button class="filter-btn fb-edu" data-cat="æ•™è‚²"><span class="ficon">ğŸ“</span><span>æ•™è‚²</span> <span class="count" id="cnt-æ•™è‚²">(0)</span></button>
  <button class="filter-btn fb-wel" data-cat="ç¦ç¥‰"><span class="ficon">â¤ï¸</span><span>ç¦ç¥‰</span> <span class="count" id="cnt-ç¦ç¥‰">(0)</span></button>
  <button class="filter-btn fb-tour" data-cat="è¦³å…‰"><span class="ficon">ğŸï¸</span><span>è¦³å…‰</span> <span class="count" id="cnt-è¦³å…‰">(0)</span></button>
  <button class="filter-btn fb-oth" data-cat="ãã®ä»–"><span class="ficon">ğŸ“„</span><span>ãã®ä»–</span> <span class="count" id="cnt-ãã®ä»–">(0)</span></button>
</div>

<div class="matrix-wrap">
  <table class="matrix" id="matrixTable">
    <colgroup>
      <col class="col-month"><!-- æœˆ -->
      <col><!-- è¦æ—¨ï¼ˆåºƒã„ï¼‰ -->
      <col class="col-cat"><!-- åˆ†é‡ï¼ˆãƒãƒ¼ãƒ•å¹…ï¼‰ -->
      <col class="col-act"><!-- æ“ä½œ -->
    </colgroup>
    <thead>
      <tr>
        <th id="thMonth">
          <button id="sortMonth" class="sort-btn" data-order="asc" aria-sort="ascending" aria-label="å¹´æœˆã§ã‚½ãƒ¼ãƒˆï¼ˆç¾åœ¨ï¼šæ˜‡é †ï¼‰">
            <span>å¹´æœˆ</span>
            <span class="sort-icon" aria-hidden="true">
              <svg class="chev" viewBox="0 0 24 24"><path d="M7 10l5 5 5-5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
            </span>
          </button>
        </th>
        <th>è¦æ—¨ãƒ»ä¼šæœŸ</th>
        <th id="thCat">
          <button id="sortCat" class="sort-btn" data-order="asc" aria-sort="none" aria-label="åˆ†é‡ã§ã‚½ãƒ¼ãƒˆï¼ˆç¾åœ¨ï¼šæœªæŒ‡å®šï¼‰">
            <span>åˆ†é‡</span>
            <span class="sort-icon" aria-hidden="true">
              <svg class="chev" viewBox="0 0 24 24"><path d="M7 10l5 5 5-5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
            </span>
          </button>
        </th>
        <th>è©³ç´°</th>
      </tr>
    </thead>
    <tbody>
      {% assign rows = site.data.matrix.rows | default: empty %}
      {% for r in rows %}
        {% assign s = r.sakio %}
        {% assign cat = r.category | default: 'ãã®ä»–' %}
        {% assign c = cat | replace:'ã€€','' | replace:' ','' | downcase %}
        {% capture catkey %}{% if c contains 'æ•™' %}edu{% elsif c contains 'ç¦' %}wel{% elsif c contains 'è¦³' %}tour{% else %}oth{% endif %}{% endcapture %}
        {% capture catlabel %}{% if catkey == 'edu' %}æ•™è‚²{% elsif catkey == 'wel' %}ç¦ç¥‰{% elsif catkey == 'tour' %}è¦³å…‰{% else %}ãã®ä»–{% endif %}{% endcapture %}
        {% capture caticon %}{% if catkey == 'edu' %}ğŸ“{% elsif catkey == 'wel' %}â¤ï¸{% elsif catkey == 'tour' %}ğŸï¸{% else %}ğŸ“„{% endif %}{% endcapture %}
        {% capture catabbr %}{% if catkey == 'edu' %}æ•™{% elsif catkey == 'wel' %}ç¦{% elsif catkey == 'tour' %}è¦³{% else %}ä»–{% endif %}{% endcapture %}
        <tr class="row"
            data-cat="{{ catlabel | strip }}"
            data-catkey="{{ catkey | strip }}"
            data-month="{{ s.month | replace:'-','' | plus:0 }}"
            data-month-iso="{{ s.month }}"
            data-title="{{ s.text | escape }}"
            data-session="{{ s.session | escape }}"
            data-pdf="{{ s.pdf | relative_url }}"
            data-related='{{ r.related | jsonify }}'>
          <td>{{ s.month }}</td>
          <td>
            <div class="cell-title">{{ s.text }}</div>
            <div class="cell-session">{{ s.session }}</div>
          </td>
          <td>
            <!-- ğŸ¨ ç¸¦ã‚¢ã‚¤ã‚³ãƒ³ï¼‹1æ–‡å­—ãƒ©ãƒ™ãƒ«ï¼ˆç‹­å°å¹…å¯¾å¿œï¼‰ã€‚ãƒ•ãƒ«åã¯title/aria-labelã«ä¿æŒ -->
            <span class="cat-pill cat-{{ catkey | strip }}" title="{{ catlabel | strip }}" aria-label="{{ catlabel | strip }}">
              <span class="icon">{{ caticon }}</span>
              <span class="label">{{ catabbr }}</span>
            </span>
          </td>
          <td>
            <div style="display:flex;flex-wrap:wrap;align-items:center;justify-content:flex-start;">
              {% if s.pdf %}
                <a class="btn pdf-link" href="{{ s.pdf | relative_url }}" data-modal="pdf" data-title="{{ s.text }}">PDF</a>
              {% endif %}
              <a class="btn ghost detail-link" href="#">è©³ç´°</a>
            </div>
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<dialog id="detailModal" aria-label="è³ªå•ã®è©³ç´°">
  <div style="display:flex;justify-content:space-between;align-items:center;padding:.7rem .9rem;border-bottom:1px solid #eee">
    <strong id="detailTitle"></strong>
    <button id="closeDetail" aria-label="é–‰ã˜ã‚‹" class="btn">Ã—</button>
  </div>
  <div style="padding:.8rem .9rem .9rem;font-size:.95rem;line-height:1.6">
    <p class="meta"><strong>ä¼šæœŸ:</strong> <span id="detailSession"></span></p>
    <p class="meta"><strong>å¹´æœˆ:</strong> <span id="detailMonth"></span>ã€€<strong>åˆ†é‡:</strong> <span id="detailCat"></span></p>
    <div id="detailRelated"></div>
    <div id="detailPDF" style="margin-top:.6rem;"></div>
  </div>
</dialog>

<!-- ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯è©³ç´°ãƒ‘ãƒãƒ« -->
<section id="detailPanel" aria-live="polite">
  <h3 id="dpTitle"></h3>
  <p class="meta"><strong>ä¼šæœŸ:</strong> <span id="dpSession"></span></p>
  <p class="meta"><strong>å¹´æœˆ:</strong> <span id="dpMonth"></span>ã€€<strong>åˆ†é‡:</strong> <span id="dpCat"></span></p>
  <div id="dpRelated"></div>
  <div id="dpPDF" style="margin-top:.6rem;"></div>
</section>

{% raw %}
<script>
document.addEventListener('DOMContentLoaded',()=>{
  const table=document.getElementById('matrixTable');
  const tbody=table.querySelector('tbody');
  const allRows=Array.from(tbody.querySelectorAll('tr.row'));

  const thMonthBtn=document.getElementById('sortMonth');
  const thCatBtn=document.getElementById('sortCat');

  const dlg=document.getElementById('detailModal');
  const dp=document.getElementById('detailPanel');

  function safeShowModal(){ try{ if(dlg && typeof dlg.showModal==='function'){ dlg.showModal(); return true; } }catch(e){} return false; }
  function closeViews(){ try{ dlg?.close(); }catch(_){ } dp?.classList.remove('active'); }
  document.getElementById('closeDetail')?.addEventListener('click',()=>{ closeViews(); rewriteHash({k:null}); });

  const CAT_ORDER=['æ•™è‚²','ç¦ç¥‰','è¦³å…‰','ãã®ä»–'];

  /* ===== ãƒãƒƒã‚·ãƒ¥ (#cat=æ•™è‚²&k=...) ===== */
  function parseHash(){ const h=(location.hash||'').replace(/^#/, ''); const obj={}; if(!h) return obj; h.split('&').forEach(p=>{ const [k,v]=p.split('='); if(k) obj[decodeURIComponent(k)]=v?decodeURIComponent(v):''; }); return obj; }
  function rewriteHash(upd){ const cur=parseHash(); const next={...cur, ...upd}; Object.keys(next).forEach(k=>{ if(next[k]==null||next[k]==='') delete next[k]; }); const h=Object.keys(next).map(k=>`${encodeURIComponent(k)}=${encodeURIComponent(next[k])}`).join('&'); history.replaceState(null,'', h?`#${h}`:location.pathname+location.search); }

  /* ===== keyç”Ÿæˆ ===== */
  function slugify(s){ return String(s||'').toLowerCase().replace(/\s+/g,'-').replace(/[^\w\-ã-ã‚“ã‚¡-ãƒ³ä¸€-é¾¥]/g,'').replace(/-+/g,'-').replace(/^-+|-+$/g,''); }
  function keyOfRow(tr){ return slugify(`${tr.dataset.cat}-${tr.dataset['monthIso']}-${tr.dataset.title}`); }

  // è¡Œãƒ»ãƒªãƒ³ã‚¯ â†’ è©³ç´°
  allRows.forEach(tr=>{
    const key=keyOfRow(tr); tr.dataset.key=key;
    tr.querySelector('a.detail-link')?.addEventListener('click',(e)=>{ e.preventDefault(); openDetail(tr); rewriteHash({k:key}); });
  });
  tbody.addEventListener('click',(e)=>{
    const row=e.target.closest('tr.row'); if(!row) return;
    if(e.target.closest('a,button,[data-modal]')) return;
    const key=row.dataset.key || keyOfRow(row);
    openDetail(row); rewriteHash({k:key});
  });

  function openDetail(row){
    const title=row.dataset.title||'', session=row.dataset.session||'', month=row.dataset['monthIso']||'', cat=row.dataset.cat||'';
    const rel=JSON.parse(row.dataset.related||'[]'); const pdf=row.dataset.pdf||'';

    // ãƒ¢ãƒ¼ãƒ€ãƒ«å†…å®¹
    document.getElementById('detailTitle').textContent=title;
    document.getElementById('detailSession').textContent=session;
    document.getElementById('detailMonth').textContent=month;
    document.getElementById('detailCat').textContent=cat;
    document.getElementById('detailRelated').innerHTML = rel.length
      ? '<strong>é¡ä¼¼è­°å“¡</strong><ul style="margin:.4rem 0 .2rem 1.1rem;">'+rel.map(x=>`<li>${x.name}ï¼ˆ${x.party}ï¼‰ï¼š${x.month}ï¼${x.topic}</li>`).join('')+'</ul>'
      : '<span class="muted">â€”</span>';
    document.getElementById('detailPDF').innerHTML = pdf
      ? `<a href="${pdf}" data-modal="pdf" class="btn">ğŸ“„ PDFã‚’é–‹ã</a>&nbsp;<a href="${pdf}" target="_blank" rel="noopener" class="btn ghost">â†—ï¸ æ–°ã—ã„ã‚¿ãƒ–</a>`
      : '<span class="muted">PDFãªã—</span>';

    // ãƒ‘ãƒãƒ«å†…å®¹
    document.getElementById('dpTitle').textContent=title;
    document.getElementById('dpSession').textContent=session;
    document.getElementById('dpMonth').textContent=month;
    document.getElementById('dpCat').textContent=cat;
    document.getElementById('dpRelated').innerHTML = rel.length
      ? '<strong>é¡ä¼¼è­°å“¡</strong><ul style="margin:.2rem 0 .2rem 1.1rem;">'+rel.map(x=>`<li>${x.name}ï¼ˆ${x.party}ï¼‰ï¼š${x.month}ï¼${x.topic}</li>`).join('')+'</ul>'
      : '<span class="muted">â€”</span>';
    document.getElementById('dpPDF').innerHTML = pdf
      ? `<a href="${pdf}" data-modal="pdf" class="btn">ğŸ“„ PDFã‚’é–‹ã</a>&nbsp;<a href="${pdf}" target="_blank" rel="noopener" class="btn ghost">â†—ï¸ æ–°ã—ã„ã‚¿ãƒ–</a>`
      : '<span class="muted">PDFãªã—</span>';

    closeViews(); if(!safeShowModal()) { document.getElementById('detailPanel').classList.add('active'); document.getElementById('detailPanel').scrollIntoView({behavior:'smooth', block:'start'}); }
  }

  /* ===== ä»¶æ•°ã‚«ã‚¦ãƒ³ãƒˆ ===== */
  const COUNTS={ 'ALL': allRows.length, 'æ•™è‚²':0,'ç¦ç¥‰':0,'è¦³å…‰':0,'ãã®ä»–':0 };
  allRows.forEach(tr=>{ const cat=tr.dataset.cat||'ãã®ä»–'; if(COUNTS[cat]!=null) COUNTS[cat]++; });
  const ids={ 'ALL':'cnt-all','æ•™è‚²':'cnt-æ•™è‚²','ç¦ç¥‰':'cnt-ç¦ç¥‰','è¦³å…‰':'cnt-è¦³å…‰','ãã®ä»–':'cnt-ãã®ä»–' };
  Object.entries(ids).forEach(([k,id])=>{ const el=document.getElementById(id); if(el) el.textContent=`(${COUNTS[k]||0})`; });

  /* ===== ãƒ•ã‚£ãƒ«ã‚¿ ===== */
  let currentFilter='ALL';
  const filterBar=document.getElementById('filterBar');
  filterBar.addEventListener('click',(e)=>{
    const b=e.target.closest('.filter-btn'); if(!b) return;
    setFilter(b.getAttribute('data-cat')||'ALL');
  });
  function setFilter(cat){
    currentFilter=cat;
    filterBar.querySelectorAll('.filter-btn').forEach(btn=>btn.setAttribute('aria-pressed', btn.getAttribute('data-cat')===cat ? 'true':'false'));
    rewriteHash({cat: cat==='ALL'? null : cat});
    allRows.forEach(tr=>{ tr.style.display=(cat==='ALL'||tr.dataset.cat===cat)?'':'none'; });
  }

  /* ===== ã‚½ãƒ¼ãƒˆ ===== */
  let sortKey='month';
  function applySort(){
    const mOrder=thMonthBtn.dataset.order, cOrder=thCatBtn.dataset.order;
    const rows=[...allRows];
    rows.sort((a,b)=>{
      const ma=+a.dataset.month, mb=+b.dataset.month;
      const ca=a.dataset.cat, cb=b.dataset.cat;
      if(sortKey==='month'){ return mOrder==='asc' ? ma-mb : mb-ma; }
      const ai=CAT_ORDER.indexOf(ca)>=0?CAT_ORDER.indexOf(ca):99;
      const bi=CAT_ORDER.indexOf(cb)>=0?CAT_ORDER.indexOf(cb):99;
      if(ai!==bi) return cOrder==='asc'? ai-bi : bi-ai;
      return mOrder==='asc'? ma-mb : mb-ma;
    });
    rows.forEach(r=>tbody.appendChild(r));
  }
  thMonthBtn.addEventListener('click',()=>{ if(sortKey!=='month'){ sortKey='month'; } else { thMonthBtn.dataset.order = thMonthBtn.dataset.order==='asc'?'desc':'asc'; } applySort(); setFilter(currentFilter); });
  thCatBtn.addEventListener('click',()=>{ if(sortKey!=='cat'){ sortKey='cat'; } else { thCatBtn.dataset.order = thCatBtn.dataset.order==='asc'?'desc':'asc'; } applySort(); setFilter(currentFilter); });

  applySort();
  function initFromHash(){ const h=parseHash(); if(h.cat){ setFilter(h.cat); } else { setFilter('ALL'); } if(h.k){ const row=allRows.find(tr=>(tr.dataset.key||keyOfRow(tr))===h.k); if(row) openDetail(row); } }
  window.addEventListener('hashchange', initFromHash);
  initFromHash();
});
</script>
{% endraw %}
