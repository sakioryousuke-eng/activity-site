---
layout: default
title: 一般質問マトリックス
---

<h1>一般質問マトリックス</h1>
<p>表の行をタップすると、質問詳細カードが開きます。PDFはその場で閲覧できます。</p>

<nav class="tabs">
  <a href="{{ '/' | relative_url }}">🏠 トップ</a>
  <a href="{{ '/pages/activity.html' | relative_url }}">🏡 活動</a>
  <a href="{{ '/pages/matrix.html' | relative_url }}" class="active">💬 一般質問</a>
</nav>

<div class="toolbar">
  <div class="filters">
    <button class="fbtn active" data-filter="all">全体</button>
    <button class="fbtn" data-filter="教育">教育</button>
    <button class="fbtn" data-filter="福祉">福祉</button>
    <button class="fbtn" data-filter="観光">観光</button>
    <button class="fbtn" data-filter="その他">その他</button>
  </div>
  <input id="kw" type="search" placeholder="キーワード検索（年月・質問・会期）">
</div>

<div class="matrix-wrap">
<table class="matrix">
  <thead>
    <tr>
      <th style="width:6rem;">年月</th>
      <th>質問要旨／会期</th>
      <th style="width:5rem;">分野</th>
      <th style="width:5rem;">資料</th>
    </tr>
  </thead>
  <tbody>
  {%- assign data = site.data.matrix -%}
  {%- assign rows = "" | split: "" -%}
  {%- for pair in data -%}
    {%- assign cat = pair[0] -%}
    {%- for item in pair[1] -%}
      {%- assign r = item.sakio -%}
      {%- assign r = r | merge: {"__cat__": cat, "related": item.related} -%}
      {%- assign rows = rows | push: r -%}
    {%- endfor -%}
  {%- endfor -%}
  {%- assign sorted = rows | sort: "month" | reverse -%}

  {%- for r in sorted -%}
  <tr class="row"
      data-title="{{ r.text }}"
      data-session="{{ r.session }}"
      data-month="{{ r.month }}"
      data-category="{{ r.__cat__ }}"
      data-pdf="{{ r.pdf }}"
      data-related='{{ r.related | jsonify }}'>
    <td><span class="ym">{{ r.month }}</span></td>
    <td>
      <div class="q-title">{{ r.text }}</div>
      <div class="q-session">{{ r.session }}</div>
    </td>
    <td><span class="badge">{{ r.__cat__ }}</span></td>
    <td>
      {% if r.pdf %}
      <a href="{{ r.pdf | relative_url }}" class="open-modal" data-title="{{ r.text }}">PDF</a>
      {% endif %}
    </td>
  </tr>
  {%- endfor -%}
  </tbody>
</table>
</div>

<!-- 詳細カードモーダル -->
<dialog id="detailModal" aria-label="詳細">
  <div class="modal-head">
    <strong id="detailTitle"></strong>
    <button id="closeDetail">×</button>
  </div>
  <div class="modal-body">
    <p><strong>会期:</strong> <span id="detailSession"></span></p>
    <p><strong>年月:</strong> <span id="detailMonth"></span></p>
    <p><strong>分野:</strong> <span id="detailCat"></span></p>
    <div id="detailRelated"></div>
    <div id="detailPDF"></div>
  </div>
</dialog>

<!-- PDFモーダル -->
<dialog id="pdfModal">
  <div class="modal-head">
    <strong id="pdfTitle">資料</strong>
    <button id="closeModal">×</button>
  </div>
  <div class="modal-body">
    <iframe id="pdfFrame" src="about:blank" title="PDFビューア"></iframe>
  </div>
</dialog>

<style>
/* 基本 */
.matrix-wrap{overflow:auto;border:1px solid #eee;border-radius:10px}
table.matrix{width:100%;border-collapse:collapse;font-size:.95rem}
.matrix th,.matrix td{padding:.45rem .5rem;border-bottom:1px solid #f1f5f9}
.matrix th{background:#fafafa;font-weight:600}
.row:hover{background:#f7fbff;cursor:pointer}

/* 列調整 */
.q-title{font-size:1.05rem;font-weight:600;line-height:1.4}
.q-session{font-size:.85rem;color:#555;margin-top:.15rem}
.ym{font-size:.85rem;color:#444}
.badge{font-size:.8rem;background:#eef5ff;border:1px solid #cfe2ff;border-radius:6px;padding:.15rem .5rem}
a.open-modal{color:#1d4ed8;text-decoration:none}

/* フィルタバー */
.toolbar{display:flex;justify-content:space-between;align-items:center;margin:.6rem 0 1rem;flex-wrap:wrap;gap:.5rem}
.filters{display:flex;gap:.4rem;flex-wrap:wrap}
.fbtn{border:1px solid #e5e7eb;background:#fff;padding:.35rem .7rem;border-radius:999px;cursor:pointer}
.fbtn.active{background:#eef5ff;border-color:#cfe2ff}
input#kw{padding:.45rem .6rem;border:1px solid #e5e7eb;border-radius:9px;width:15rem;max-width:60vw}

/* モーダル */
dialog{border:none;border-radius:12px;padding:0;box-shadow:0 20px 50px rgba(0,0,0,.25);width:min(680px,94vw)}
dialog::backdrop{background:rgba(0,0,0,.35)}
.modal-head{display:flex;justify-content:space-between;align-items:center;padding:.8rem 1rem;border-bottom:1px solid #eee;background:#fafafa}
.modal-body{padding:1rem;font-size:.95rem}
.modal-body p{margin:.4rem 0}
.modal-body a{color:#1d4ed8;text-decoration:none}
.modal-body iframe{width:100%;height:80vh;border:none;border-radius:6px}
body.modal-open{overflow:hidden}

/* スマホ最適化 */
@media(max-width:720px){
  .matrix th,.matrix td{padding:.25rem .4rem}
  .q-title{font-size:.95rem}
  .q-session{font-size:.8rem}
  .ym{font-size:.8rem}
  dialog#pdfModal{width:100vw;height:100vh;border-radius:0}
  dialog#pdfModal iframe{height:calc(100vh - 48px)}
}
</style>

<script>
// ==== フィルタ・検索 ====
function applyFilter(){
  const f = document.querySelector('.fbtn.active')?.dataset.filter || 'all';
  const kw = (document.getElementById('kw').value || '').toLowerCase();
  document.querySelectorAll('tbody tr.row').forEach(r=>{
    const cat=r.dataset.category;
    const txt=(r.dataset.title+' '+r.dataset.session).toLowerCase();
    r.style.display=(f==='all'||f===cat)&&(txt.includes(kw))?'':'none';
  });
}
document.querySelectorAll('.fbtn').forEach(b=>b.addEventListener('click',()=>{
  document.querySelectorAll('.fbtn').forEach(x=>x.classList.remove('active'));
  b.classList.add('active');
  applyFilter();
}));
document.getElementById('kw').addEventListener('input',applyFilter);

// ==== 詳細カード ====
const dlgDetail=document.getElementById('detailModal');
document.addEventListener('click',e=>{
  const row=e.target.closest('tr.row');
  if(!row)return;
  document.getElementById('detailTitle').textContent=row.dataset.title;
  document.getElementById('detailSession').textContent=row.dataset.session;
  document.getElementById('detailMonth').textContent=row.dataset.month;
  document.getElementById('detailCat').textContent=row.dataset.category;
  // 類似議員
  const rel=JSON.parse(row.dataset.related||'[]');
  const relDiv=document.getElementById('detailRelated');
  relDiv.innerHTML=rel.length?'<strong>類似議員:</strong><ul>'+rel.map(x=>`<li>${x.name}（${x.party}）：${x.month}／${x.topic}</li>`).join('')+'</ul>':'';
  // PDF
  const pdf=row.dataset.pdf;
  const pdfDiv=document.getElementById('detailPDF');
  pdfDiv.innerHTML=pdf?`<p><a href="${pdf}" class="open-modal" data-title="${row.dataset.title}">📄 PDFを開く</a></p>`:'';
  dlgDetail.showModal();
});
document.getElementById('closeDetail').addEventListener('click',()=>dlgDetail.close());

// ==== PDFモーダル ====
const dlgPDF=document.getElementById('pdfModal');
const frame=document.getElementById('pdfFrame');
document.addEventListener('click',e=>{
  const a=e.target.closest('a.open-modal');
  if(!a)return;
  e.preventDefault();
  frame.src=a.getAttribute('href')+'#view=FitH';
  document.getElementById('pdfTitle').textContent=a.dataset.title||'資料';
  dlgPDF.showModal();
});
document.getElementById('closeModal').addEventListener('click',()=>{
  dlgPDF.close();frame.src='about:blank';
});
applyFilter();
</script>
