---
layout: default
title: ã‚¿ã‚°
permalink: /pages/tags.html
---

<h2>ã‚¿ã‚°</h2>
<div class="card" id="tagCloud" style="margin-bottom:16px;"></div>
<div id="list" class="grid" role="list" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:16px;"></div>

<script>
(function(){
  const base='{{ site.baseurl | default: "" }}';
  const withBase = (p) => {
    if (!p) return null;
    if (/^https?:\/\//i.test(p)) return p;
    if (p.startsWith(base + '/')) return p;
    if (p.startsWith('/')) return base + p;
    return base + '/' + p.replace(/^\.\//,'');
  };
  const arr = v => Array.isArray(v) ? v : (v ? [v] : []);

  /* === æ´»å‹• === */
  const POSTS = [
    {% assign posts = site.posts | sort: "date" | reverse %}
    {% for post in posts %}
      {
        type: 'æ´»å‹•',
        title: {{ post.title | jsonify }},
        text: {{ post.excerpt | default: post.content | strip_html | strip_newlines | truncate: 160 | jsonify }},
        url: {{ post.url | relative_url | jsonify }},
        pdf: {{ post.pdf | default: nil | jsonify }},
        tags: ({{ post.tags | jsonify }} || []).concat({{ post.categories | jsonify }} || []),
        date: {{ post.date | date: "%Y-%m-%d" | jsonify }},
        image: {% if post.images and post.images.size > 0 %} {{ post.images[0] | relative_url | jsonify }} {% else %} null {% endif %}
      }{% unless forloop.last %},{% endunless %}
    {% endfor %}
  ];

  /* === å…¬ç´„ãƒ»ä¸€èˆ¬è³ªå• === */
  {% assign P0 = site.data.promises.promises | default: site.data.promises %}
  {% assign M0 = site.data.matrix.rows | default: site.data.matrix.categories | default: site.data.matrix %}
  const P = {{ P0 | jsonify | default: '[]' }};
  const M = {{ M0 | jsonify | default: '[]' }};

  const promises = (Array.isArray(P) ? P : []).map(p => ({
    type:'å…¬ç´„',
    title:p.title||'',
    text:p.detail||'',
    url: withBase('/pages/promise.html'),
    pdf: withBase(p.pdf || null),
    tags: arr(p.tags).concat(arr(p.tag)).filter(Boolean)
  }));

  const matrix = (Array.isArray(M) ? M : []).flatMap(m=>{
    if(!m||!m.category) return [];
    const sakioArr = arr(m.sakio);
    const relatedArr = arr(m.related);
    const t1 = sakioArr.map(x=>x?.title||x?.text||x).join(' ');
    const t2 = relatedArr.map(x=>x?.title||x?.topic||x).join(' ');
    const pdf = (sakioArr[0] && sakioArr[0].pdf) ? sakioArr[0].pdf : (m.pdf || null);
    return [{
      type:'ä¸€èˆ¬è³ªå•',
      title:m.category,
      text:`${t1} ${t2}`.trim(),
      url: withBase('/pages/matrix.html'),
      pdf: withBase(pdf),
      tags:[m.category]
    }];
  });

  /* â–¼ çµ±åˆ */
  const items = [].concat(POSTS, promises, matrix);

  /* â–¼ è‡ªå‹•ã‚¿ã‚°è£œå¼· */
  for(const it of items){
    const t = ((it.text||'') + ' ' + (it.title||''));
    it.tags = arr(it.tags);
    if(/åœ°åŸŸ|ä½æ°‘|è‡ªæ²»|äº¤æµ/.test(t)) it.tags.push('åœ°åŸŸ');
    if(/è­°ä¼š|è³ªå•|ç­”å¼|å§”å“¡ä¼š|æ¡ä¾‹/.test(t)) it.tags.push('è­°ä¼š');
    if(/è¡Œæ”¿|å¸‚å½¹æ‰€|åºèˆ|å…¬å…±|æ–½ç­–/.test(t)) it.tags.push('è¡Œæ”¿');
  }

  /* â–¼ ã‚¿ã‚°é›†è¨ˆ */
  const tagMap = new Map();
  for(const it of items){
    const ts = it.tags && it.tags.length ? [...new Set(it.tags)] : ['æœªåˆ†é¡'];
    for(const tg of ts){
      if(!tagMap.has(tg)) tagMap.set(tg,[]);
      tagMap.get(tg).push(it);
    }
  }

  /* â–¼ ã‚¢ã‚¤ã‚³ãƒ³å‰²ã‚Šå½“ã¦ */
  const tagIcon = (t)=>{
    return {
      åœ°åŸŸ:'ğŸŒ³', è­°ä¼š:'ğŸ›ï¸', è¡Œæ”¿:'âš™ï¸',
      æ•™è‚²:'ğŸ“', è¦³å…‰:'ğŸï¸', ç¦ç¥‰:'â¤ï¸', ãã®ä»–:'ğŸ“„',
      å…¬ç´„:'ğŸ“Œ', æ´»å‹•:'ğŸ“', ä¸€èˆ¬è³ªå•:'â“', æœªåˆ†é¡:'ğŸ·ï¸'
    }[t] || 'ğŸ·ï¸';
  };

  const tagCloud=document.getElementById('tagCloud');
  const list=document.getElementById('list');
  const tags=[...tagMap.entries()].sort((a,b)=>b[1].length-a[1].length);

  function renderCloud(activeTag){
    const btn = (t,count)=>{
      const pressed = (activeTag===t)?' aria-pressed="true"':'';
      return `<button class="tagbtn t-${cssSafe(t)}" data-tag="${escapeHtml(t)}"${pressed}>
                <span class="ico">${tagIcon(t)}</span><span class="label">${t}</span>
                <span class="num">(${count})</span>
              </button>`;
    };
    const total=items.length;
    const allPressed=(activeTag==='*'||!activeTag)?' aria-pressed="true"':'';
    tagCloud.innerHTML=
      `<div class="tagbar">
         <button class="tagbtn t-all" data-tag="*"${allPressed}><span class="ico">ğŸ—‚ï¸</span><span>ã™ã¹ã¦</span><span class="num">(${total})</span></button>
         ${tags.map(([t,arr])=>btn(t,arr.length)).join('')}
       </div>`;
  }

  function card(it){
    const pills=(it.tags||[]).slice(0,6).map(t=>`
      <span class="tagpill t-${cssSafe(t)}">
        <span class="tp-ico">${tagIcon(t)}</span><span>${t}</span>
      </span>`).join('');
    const img=it.image?`<img src="${withBase(it.image)}" alt="" style="width:100%;border-radius:8px;border:1px solid #eee;margin:.25rem 0">`:'';
    return `<article class="card">
      <div class="muted" style="font-size:.8rem;margin-bottom:.25rem">
        <span class="badge" data-type="${it.type}">${it.type}</span> ${it.date?`Â· <time>${it.date}</time>`:''}
      </div>
      <h3 style="margin:.1em 0 .25em;font-size:1.05rem;line-height:1.35">${escapeHtml(it.title||'')}</h3>
      <p class="clamp-2">${escapeHtml(it.text||'')}</p>
      ${img}
      <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:.35rem;">
        ${it.pdf?`<a class="btn btn-primary" href="${it.pdf}">PDFã‚’é–‹ã</a>`:''}
        ${it.url?`<a class="btn" href="${withBase(it.url)}">è©²å½“ãƒšãƒ¼ã‚¸</a>`:''}
      </div>
      <div class="tp-wrap">${pills}</div>
    </article>`;
  }

  function render(tag){
    const arr=(tag==='*'||!tag)?items:(tagMap.get(tag)||[]);
    list.innerHTML=arr.map(card).join('');
    renderCloud(tag||'*');
  }

  tagCloud.addEventListener('click',e=>{
    const b=e.target.closest('button[data-tag]');if(!b)return;
    const t=b.dataset.tag;
    if(t==='*')history.replaceState(null,'',location.pathname);else location.hash=encodeURIComponent(t);
    selectByHash();
  });
  const currentHash=()=>decodeURIComponent((location.hash||'').replace(/^#/,''));
  function selectByHash(){
    const t=currentHash();
    render(t&&tagMap.has(t)?t:'*');
  }
  function escapeHtml(s){return String(s).replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));}
  function cssSafe(s){return String(s).replace(/\s+/g,'-');}
  selectByHash();
})();
</script>

<style>
:root{
  --fg:#0f172a;--muted:#64748b;--line:#e2e8f0;--chip:#f8fafc;
  --bg-card:#fff;--shadow:0 4px 16px rgba(0,0,0,.06);
}
.card{background:var(--bg-card);border:1px solid var(--line);border-radius:14px;padding:14px;transition:.2s box-shadow,.2s transform}
.card:hover{box-shadow:var(--shadow);transform:translateY(-1px)}
.card h3{margin:.1em 0;font-size:1.05rem}
.muted{color:var(--muted)}
.badge{display:inline-flex;align-items:center;gap:.35em;font:600 .75rem/1.2 system-ui;padding:.25em .6em;border-radius:999px;background:#eef2ff;color:#3730a3;border:1px solid #e0e7ff}
.badge[data-type="å…¬ç´„"]{background:#ecfeff;color:#155e75}
.badge[data-type="æ´»å‹•"]{background:#f1f5f9;color:#334155}
.badge[data-type="ä¸€èˆ¬è³ªå•"]{background:#eef2ff;color:#4f46e5}

/* ã‚¿ã‚°ã‚¯ãƒ©ã‚¦ãƒ‰ */
.tagbar{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:8px}
.tagbtn{
  display:flex;align-items:center;justify-content:center;gap:.4em;
  padding:.42em .5em;border:1px solid var(--line);border-radius:999px;background:#fff;
  font:600 .85rem/1 system-ui;cursor:pointer
}
.tagbtn .ico{font-size:1rem}
.tagbtn .num{color:var(--muted);font-size:.82em}
.tagbtn[aria-pressed="true"]{border-color:#a78bfa;background:#eef2ff}

/* ã‚¿ã‚°è‰²è¨­å®š */
.t-åœ°åŸŸ{border-color:#86efac;background:#f0fdf4;color:#166534}
.t-è­°ä¼š{border-color:#93c5fd;background:#eff6ff;color:#1e3a8a}
.t-è¡Œæ”¿{border-color:#cbd5e1;background:#f1f5f9;color:#334155}
.t-æ•™è‚²{border-color:#a5b4fc;background:#eef2ff;color:#3730a3}
.t-è¦³å…‰{border-color:#6ee7b7;background:#ecfdf5;color:#065f46}
.t-ç¦ç¥‰{border-color:#f9a8d4;background:#fdf2f8;color:#831843}
.t-ãã®ä»–{border-color:#e2e8f0;background:#f9fafb;color:#475569}
.t-å…¬ç´„{border-color:#7dd3fc;background:#ecfeff;color:#075985}
.t-æ´»å‹•{border-color:#dbeafe;background:#f8fafc;color:#1e293b}
.t-ä¸€èˆ¬è³ªå•{border-color:#c7d2fe;background:#eef2ff;color:#312e81}
.t-æœªåˆ†é¡{border-color:#e5e7eb;background:#f9fafb;color:#4b5563}

/* ã‚«ãƒ¼ãƒ‰å†…ã‚¿ã‚°ãƒ”ãƒ« */
.tp-wrap{display:flex;flex-wrap:wrap;gap:6px;margin-top:.3rem}
.tagpill{
  display:inline-flex;align-items:center;gap:.3em;
  padding:.24em .5em;border-radius:999px;font:.72rem/1 system-ui;
}
.tagpill .tp-ico{font-size:.9rem;line-height:1}

/* å…±é€šãƒœã‚¿ãƒ³ */
.btn{border-radius:10px;border:1px solid var(--line);padding:.5em .8em;text-decoration:none}
.btn-primary{border-color:#93c5fd}
</style>
