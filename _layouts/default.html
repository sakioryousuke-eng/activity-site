  <script>
  (function(){
    const dlg   = document.getElementById('globalPdfModal');
    const frame = document.getElementById('globalPdfFrame');
    const title = document.getElementById('globalPdfTitle');
    const btnClose = document.getElementById('closeGlobalPdf');
    if(!dlg||!frame) return;

    // PDFを常に画面サイズにフィットさせて開く関数
    function withPdfViewerParams(href){
      try{
        const url = new URL(href, window.location.href);
        const rawHash = url.hash.replace(/^#/,'');
        const sp = new URLSearchParams(rawHash);

        // 🟢 SafariやiPhone対応：1ページ全体を画面に収める
        sp.set('view','Fit');            // ← ★ ここをpage-fitから変更
        sp.set('zoom','page-fit');       // 念のため併記（PCビューワ用）
        sp.set('toolbar','0');
        sp.set('navpanes','0');

        url.hash = sp.toString();
        return url.toString();
      }catch(e){
        return href + (href.includes('#') ? '&' : '#') + 'view=Fit&zoom=page-fit&toolbar=0&navpanes=0';
      }
    }

    // data-modal="pdf" のリンクを横取りしてモーダル表示
    document.addEventListener('click', function(e){
      const a = e.target.closest('a[data-modal="pdf"]');
      if(!a) return;
      e.preventDefault();

      title.textContent = a.dataset.title || 'PDF';
      frame.src = withPdfViewerParams(a.getAttribute('href'));
      document.body.classList.add('noscroll');
      dlg.showModal();
    }, {passive:false});

    function closePdf(){
      frame.src = 'about:blank';
      dlg.close();
      document.body.classList.remove('noscroll');
    }
    btnClose.addEventListener('click', closePdf);
    dlg.addEventListener('close', closePdf);
    document.addEventListener('keydown', (e)=>{ if(e.key==='Escape' && dlg.open) closePdf(); });
  })();
  </script>

