<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>{{ page.title }} | {{ site.title }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  {%- if site.description -%}<meta name="description" content="{{ site.description }}">{%- endif -%}
  <link rel="canonical" href="{{ page.url | absolute_url }}">

  <style>
    :root { --max: 980px; --pad: 16px; --radius: 14px; }
    * { box-sizing: border-box; }
    body { margin:0; font: 16px/1.65 -apple-system,BlinkMacSystemFont,"Segoe UI","Hiragino Kaku Gothic ProN","Noto Sans JP",sans-serif; color:#111; background:#fff; }
    header, main, footer { max-width: var(--max); margin: 0 auto; padding: 0 var(--pad); }
    header { padding-top: 14px; padding-bottom: 8px; }
    h1 { font-size: 1.25rem; margin: 0; }
    nav ul { list-style: none; display: flex; gap: 10px; flex-wrap: wrap; padding: 0; margin: 10px 0 0; }
    nav a { display:block; padding:10px 14px; border:1px solid #eee; border-radius: var(--radius); text-decoration:none; color:#111; }
    nav a:hover { background:#f7f7f7; }
    main { padding: 16px 0 24px; }
    .card { border:1px solid #eee; border-radius: var(--radius); padding:16px; background:#fff; }
    img { max-width:100%; height:auto; }
    @media (min-width: 768px) { body { font-size: 17px; } }
  </style>
</head>
<body>
  <header>
    <h1>{{ site.title | default: "activity-site" }}</h1>
    <nav>
      <ul>
        <li><a href="{{ '/' | relative_url }}">プロフィール</a></li>
        <li><a href="{{ '/pages/promise.html' | relative_url }}">公約</a></li>
        <li><a href="{{ '/pages/activity.html' | relative_url }}">活動</a></li>
        <li><a href="{{ '/pages/matrix.html' | relative_url }}">一般質問</a></li>
      </ul>
    </nav>
  </header>

  <main>
    {{ content }}
  </main>

  <footer style="padding:24px 0; color:#666;">
    <small>&copy; {{ site.time | date: '%Y' }} {{ site.author | default: 'sakioyousuke-eng' }}</small>
  </footer>

  <!-- ▼ 共通PDFモーダル（公約の理論を正確移植） -->
  <dialog id="pdfModal" aria-label="PDFを表示">
    <div class="pdf-head">
      <strong id="pdfTitle">PDF</strong>
      <button id="pdfClose" aria-label="閉じる">×</button>
    </div>
    <div class="pdf-body">
      <iframe id="pdfFrame" title="PDF表示" loading="lazy" referrerpolicy="no-referrer"></iframe>
    </div>
  </dialog>

  <style>
    /* ===== 公約と同じ見え方（zoom=50・見切れ無し・ドラッグ不可）を全ページへ ===== */
    #pdfModal{
      position:fixed; inset:0; margin:0; padding:0; border:none; background:#fff;
      width:100vw; max-width:100vw; height:100svh; border-radius:0; overflow:hidden;
      --pdf-head-h: 64px;
    }
    @supports not (height:100svh){ #pdfModal{ height:100dvh; } }
    #pdfModal::backdrop{ background:rgba(0,0,0,.35); }

    #pdfModal .pdf-head{
      display:flex; justify-content:space-between; align-items:center;
      background:#fff; border-bottom:1px solid #eee; min-height:48px;
      padding:.7rem .9rem;
      padding-top:calc(.7rem + env(safe-area-inset-top));
      padding-left:calc(.9rem + env(safe-area-inset-left));
      padding-right:calc(.9rem + env(safe-area-inset-right));
    }
    #pdfModal .pdf-head button{
      border:none; background:#fff; font-size:1.1rem; line-height:1;
      border-radius:8px; padding:.3rem .5rem; cursor:pointer;
    }

    #pdfModal .pdf-body{
      position:absolute;
      top: var(--pdf-head-h);
      left: env(safe-area-inset-left);
      right: env(safe-area-inset-right);
      bottom: env(safe-area-inset-bottom);
      background:#fff; overflow:hidden; margin:0;
    }

    #pdfFrame{
      display:block; width:100%; height:100%; border:0; background:#fff;
      height:-webkit-fill-available;    /* 旧Safariの余白対策 */
      pointer-events: none;             /* ← PDF自体はドラッグ/ズーム不可 */
      user-select: none;
    }
  </style>

  {% raw %}
  <script>
  (function(){
    const dlg   = document.getElementById('pdfModal');
    const head  = dlg.querySelector('.pdf-head');
    const frame = document.getElementById('pdfFrame');
    const title = document.getElementById('pdfTitle');
    const btn   = document.getElementById('pdfClose');

    // 公約と同じ：初期倍率 50%、ツールバー/ナビ枠OFF
    function toZoom50(href){
      try{
        const url = new URL(href, location.href);
        const sp  = new URLSearchParams(url.hash.replace(/^#/,''));
        sp.set('zoom','50'); sp.set('toolbar','0'); sp.set('navpanes','0');
        url.hash = sp.toString();
        return url.toString();
      }catch(_){
        return href + (href.includes('#') ? '&' : '#') + 'zoom=50&toolbar=0&navpanes=0';
      }
    }

    function applyHeadHeight(){
      const h = Math.ceil(head.getBoundingClientRect().height);
      dlg.style.setProperty('--pdf-head-h', h + 'px');
    }

    function openPdf(href, ttl){
      title.textContent = ttl || 'PDF';
      frame.src = toZoom50(href);
      applyHeadHeight();
      dlg.showModal();
    }
    function closePdf(){
      frame.src = 'about:blank';
      dlg.close();
    }

    btn.addEventListener('click', closePdf);
    dlg.addEventListener('close', closePdf);
    window.addEventListener('resize', ()=>{ if(dlg.open) applyHeadHeight(); });
    window.addEventListener('orientationchange', ()=>{ if(dlg.open) applyHeadHeight(); });

    // 全ページ共通：data-modal="pdf" をクリックしたらこのモーダルで開く
    document.addEventListener('click', function(e){
      const a = e.target.closest('a[data-modal="pdf"]');
      if(!a) return;
      e.preventDefault();
      openPdf(a.getAttribute('href'), a.dataset.title || a.textContent || 'PDF');
    }, {passive:false});
  })();
  </script>
  {% endraw %}
  <!-- ▲ 共通PDFモーダル -->
</body>
</html>


