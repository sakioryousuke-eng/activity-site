  <script>
  (function(){
    const dlg   = document.getElementById('globalPdfModal');
    const frame = document.getElementById('globalPdfFrame');
    const title = document.getElementById('globalPdfTitle');
    const btnClose = document.getElementById('closeGlobalPdf');
    if(!dlg||!frame) return;

    // PDFã‚’å¸¸ã«ç”»é¢ã‚µã‚¤ã‚ºã«ãƒ•ã‚£ãƒƒãƒˆã•ã›ã¦é–‹ãé–¢æ•°
    function withPdfViewerParams(href){
      try{
        const url = new URL(href, window.location.href);
        const rawHash = url.hash.replace(/^#/,'');
        const sp = new URLSearchParams(rawHash);

        // ðŸŸ¢ Safariã‚„iPhoneå¯¾å¿œï¼š1ãƒšãƒ¼ã‚¸å…¨ä½“ã‚’ç”»é¢ã«åŽã‚ã‚‹
        sp.set('view','Fit');            // â† â˜… ã“ã“ã‚’page-fitã‹ã‚‰å¤‰æ›´
        sp.set('zoom','page-fit');       // å¿µã®ãŸã‚ä½µè¨˜ï¼ˆPCãƒ“ãƒ¥ãƒ¼ãƒ¯ç”¨ï¼‰
        sp.set('toolbar','0');
        sp.set('navpanes','0');

        url.hash = sp.toString();
        return url.toString();
      }catch(e){
        return href + (href.includes('#') ? '&' : '#') + 'view=Fit&zoom=page-fit&toolbar=0&navpanes=0';
      }
    }

    // data-modal="pdf" ã®ãƒªãƒ³ã‚¯ã‚’æ¨ªå–ã‚Šã—ã¦ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º
    document.addEventListener('click', function(e){
      const a = e.target.closest('a[data-modal="pdf"]');
      if(!a) return;
      e.preventDefault();

      title.textContent = a.dataset.title || 'PDF';
      frame.src = withPdfViewerParams(a.getAttribute('href'));
      document.body.classList.add('noscroll');
      dlg.showModal();
    }, {passive:false});

    function closePdf(){
      frame.src = 'about:blank';
      dlg.close();
      document.body.classList.remove('noscroll');
    }
    btnClose.addEventListener('click', closePdf);
    dlg.addEventListener('close', closePdf);
    document.addEventListener('keydown', (e)=>{ if(e.key==='Escape' && dlg.open) closePdf(); });
  })();
  </script>

