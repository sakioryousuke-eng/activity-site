<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>{{ page.title }} | {{ site.title }}</title>
  <meta name="description" content="{{ site.description }}">
  {% seo %}

  <style>
    :root{
      --base-font:'Noto Sans JP',system-ui,sans-serif;
      --accent:#2563eb; --bg:#f9fafb; --text:#111827; --radius:12px;
      --safe-top: env(safe-area-inset-top,0px);
      --safe-bottom: env(safe-area-inset-bottom,0px);
    }
    *{box-sizing:border-box}
    body{font-family:var(--base-font);margin:0;background:var(--bg);color:var(--text);line-height:1.6}
    header{background:#fff;border-bottom:1px solid #e5e7eb;padding:.8rem 1rem;position:sticky;top:0;z-index:10}
    header h1{font-size:1.2rem;margin:0;text-align:center;font-weight:700}
    header a{text-decoration:none;color:inherit}
    nav.global{display:flex;justify-content:center;flex-wrap:wrap;gap:.4rem;margin-top:.4rem}
    nav.global a{padding:.3rem .6rem;border-radius:8px;font-size:.9rem;text-decoration:none;color:#374151;background:#f3f4f6;border:1px solid #e5e7eb;transition:background .2s}
    nav.global a:hover,nav.global a.active{background:#e0ebff;color:var(--accent);border-color:#bfdbfe}
    main{max-width:960px;margin:0 auto;padding:1.2rem;background:#fff;border-radius:var(--radius);box-shadow:0 2px 8px rgba(0,0,0,.04)}
    footer{text-align:center;color:#6b7280;font-size:.85rem;margin:1.5rem 0 2rem}
    @media (max-width:720px){
      main{padding:.9rem;border-radius:0;box-shadow:none}
      header h1{font-size:1rem}
      nav.global a{font-size:.82rem;padding:.25rem .5rem}
    }

    /* ===== PDFãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆå…¨ãƒšãƒ¼ã‚¸å…±é€šï¼‰ ===== */
    dialog#pdfModal{border:none;padding:0;border-radius:16px;box-shadow:0 20px 50px rgba(0,0,0,.25);
      width:min(960px,96vw);height:min(88vh,860px)}
    dialog::backdrop{background:rgba(0,0,0,.35)}
    /* ã‚¹ãƒãƒ›ã§ã¯ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ï¼†å®‰å…¨åŸŸè€ƒæ…® */
    @media (max-width:720px){
      dialog#pdfModal{margin:0;border-radius:0;width:100vw;height:100vh}
      @supports (height:100dvh){ dialog#pdfModal{width:100dvw;height:100dvh} }
    }
    .modal-head{display:flex;justify-content:space-between;align-items:center;
      padding:calc(.6rem + var(--safe-top)) .9rem .6rem;border-bottom:1px solid #e5e7eb;background:#fafafa}
    .modal-body{height:calc(100% - 48px - var(--safe-top) - var(--safe-bottom));padding-bottom:var(--safe-bottom);overflow:hidden}
    #pdfFrame{display:block;width:100%;height:100%}
    #closeModal{border:none;background:#fff;width:34px;height:34px;border-radius:10px;cursor:pointer;font-size:1.1rem}
    #closeModal:hover{background:#f3f4f6}
    body.modal-open{overflow:hidden;overscroll-behavior:contain}
  </style>
</head>
<body>

<header>
  <h1><a href="{{ '/' | relative_url }}">{{ site.title }}</a></h1>
  <nav class="global">
    <a href="{{ '/' | relative_url }}" class="{% if page.url == '/' or page.url == '/index.html' %}active{% endif %}">ğŸ  ãƒˆãƒƒãƒ—</a>
    <a href="{{ '/pages/promise.html' | relative_url }}" class="{% if page.url contains '/pages/promise' %}active{% endif %}">ğŸ“Œ å…¬ç´„</a>
    <a href="{{ '/pages/activity.html' | relative_url }}" class="{% if page.url contains '/pages/activity' %}active{% endif %}">ğŸ¡ æ´»å‹•</a>
    <a href="{{ '/pages/matrix.html' | relative_url }}" class="{% if page.url contains '/pages/matrix' %}active{% endif %}">ğŸ’¬ ä¸€èˆ¬è³ªå•</a>
    <a href="{{ '/pages/profile.html' | relative_url }}" class="{% if page.url contains '/pages/profile' %}active{% endif %}">ğŸ‘¤ ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</a>
  </nav>
</header>

<main>
  {{ content }}
</main>

<footer>
  <p>Â© {{ site.time | date: '%Y' }} {{ site.title }}. All rights reserved.</p>
</footer>

<!-- === PDFãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆå…±é€šï¼‰ === -->
<dialog id="pdfModal" aria-label="PDFè¡¨ç¤ºãƒ¢ãƒ¼ãƒ€ãƒ«">
  <div class="modal-head">
    <strong id="pdfTitle">è³‡æ–™</strong>
    <button id="closeModal" aria-label="é–‰ã˜ã‚‹">Ã—</button>
  </div>
  <div class="modal-body">
    <iframe id="pdfFrame" src="about:blank" title="PDFãƒ“ãƒ¥ãƒ¼ã‚¢" frameborder="0"></iframe>
  </div>
</dialog>

<script>
(() => {
  const dlg = document.getElementById('pdfModal');
  const frame = document.getElementById('pdfFrame');
  const pdfTitle = document.getElementById('pdfTitle');

  // ä¸ãˆã‚‰ã‚ŒãŸURLã«ã€Œã‚­ãƒ£ãƒƒã‚·ãƒ¥å›é¿ã®ã‚¯ã‚¨ãƒªã€ã¨ã€ŒåˆæœŸå€ç‡:ãƒšãƒ¼ã‚¸å…¨ä½“ã€ã‚’å¿…ãšä»˜ä¸
  function buildPdfSrc(rawUrl){
    const split = rawUrl.split('#');              // æ—¢å­˜ã®ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã‚’ä¿æŒ
    const base = split[0];
    const frag = split[1] ? split[1] : '';
    const t = 't=' + Date.now();

    // æ—¢å­˜ã‚¯ã‚¨ãƒªã®æœ‰ç„¡ã§ ? / & ã‚’åˆ‡æ›¿
    const qJoined = base + (base.includes('?') ? '&' : '?') + t;

    // æ—¢å­˜ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆãŒã‚ã‚‹å ´åˆã‚‚æ®‹ã—ã¤ã¤ zoom=page-fit ã‚’å¿…ãšè¿½åŠ 
    const hash = frag ? (frag.includes('zoom=') ? frag : frag + '&zoom=page-fit')
                      : 'zoom=page-fit';

    return qJoined + '#' + hash;
  }

  function openPdfModal(url, title){
    frame.src = buildPdfSrc(url);
    pdfTitle.textContent = title || 'è³‡æ–™';
    dlg.showModal();
    document.body.classList.add('modal-open');
  }

  // é–‰ã˜ã‚‹
  document.getElementById('closeModal').addEventListener('click', () => {
    dlg.close();
    frame.src = 'about:blank';
    document.body.classList.remove('modal-open');
  });
  document.addEventListener('keydown', e => {
    if (e.key === 'Escape' && dlg.open) {
      dlg.close();
      frame.src = 'about:blank';
      document.body.classList.remove('modal-open');
    }
  });

  // ---- ã‚¯ãƒªãƒƒã‚¯ã®æ‹¾ã„æ–¹ ----
  // 1) data-pdf ã‚’æŒã¤è¦ç´ ï¼ˆã‚«ãƒ¼ãƒ‰ç­‰ï¼‰
  // 2) <a> ã§ href ãŒ .pdf ã®ãƒªãƒ³ã‚¯ã« data-modal="pdf" ãŒä»˜ã„ã¦ã„ã‚‹ã‚‚ã®ï¼ˆmatrix ãªã©ï¼‰
  document.addEventListener('click', e => {
    // detailså†…éƒ¨ã®ã‚¯ãƒªãƒƒã‚¯ã¯é™¤å¤–ï¼ˆå±•é–‹ã‚’é‚ªé­”ã—ãªã„ï¼‰
    if (e.target.closest('details')) return;

    const card = e.target.closest('[data-pdf]');
    if (card) {
      e.preventDefault();
      const url = card.getAttribute('data-pdf');
      const title = card.getAttribute('data-title') || card.textContent.trim();
      if (url) openPdfModal(url, title);
      return;
    }

    const a = e.target.closest('a[data-modal="pdf"]');
    if (a) {
      const href = a.getAttribute('href') || '';
      if (href.toLowerCase().endsWith('.pdf')) {
        e.preventDefault();
        const title = a.getAttribute('data-title') || a.textContent.trim();
        openPdfModal(href, title);
      }
    }
  });
})();
</script>

</body>
</html>
