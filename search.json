---
layout: null
permalink: /search.json
---

[
{%- assign base = site.baseurl | default: "" -%}
{%- assign entries = "" | split: "" -%}

{%- comment -%} 1) 投稿 {%- endcomment -%}
{%- for p in site.posts -%}
  {%- assign e = {
    "type": "post",
    "title": p.title,
    "url": base | append: p.url,
    "date": p.date | date: "%Y-%m-%d",
    "tags": p.tags | default: empty,
    "categories": p.categories | default: empty,
    "excerpt": p.excerpt | default: p.content | strip_html | strip_newlines | truncate: 180,
    "content": p.content | strip_html | strip_newlines
  } -%}
  {%- assign entries = entries | push: e -%}
{%- endfor -%}

{%- comment -%} 2) _data/matrix.yml から一般質問だけを項目単位で追加 {%- endcomment -%}
{%- if site.data.matrix -%}
  {%- assign R = site.data.matrix.rows | default: site.data.matrix.categories | default: site.data.matrix -%}
  {%- for m in R -%}
    {%- assign sak = m.sakio | default: empty -%}
    {%- assign rel = m.related | default: empty -%}
    {%- capture text -%}
      {%- for x in sak -%} {{ x.title | default: x.text | default: x }} {%- endfor -%}
      {%- for y in rel -%} {{ y.title | default: y.topic | default: y }} {%- endfor -%}
    {%- endcapture -%}

    {%- assign matrix_url = "/pages/matrix.html#" | append: m.category | uri_escape -%}
    {%- assign full_url = base | append: matrix_url -%}

    {%- assign e = {
      "type": "question",
      "title": m.category | default: "一般質問",
      "url": full_url,
      "date": "",
      "tags": m.tags | default: empty,
      "categories": ["一般質問"],
      "excerpt": text | strip_html | strip_newlines | truncate: 180,
      "content": text | strip_html | strip_newlines
    } -%}
    {%- assign entries = entries | push: e -%}
  {%- endfor -%}
{%- endif -%}

{%- comment -%} 3) JSON 出力 {%- endcomment -%}
{%- for e in entries -%}
  {%- unless forloop.first -%},{%- endunless -%}
  {{ e | jsonify }}
{%- endfor -%}
]


