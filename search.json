---
layout: null
permalink: /search.json
---

[
{%- assign base = site.baseurl | default: "" -%}
{%- assign empty_array = "" | split: "" -%}
{%- assign first = true -%}

{%- comment -%} 1) _posts {%- endcomment -%}
{%- for p in site.posts -%}
  {%- assign pdf_raw = p.pdf | default: "" -%}
  {%- assign pdf_url = "" -%}
  {%- if pdf_raw != "" -%}{%- assign pdf_url = base | append: pdf_raw -%}{%- endif -%}
  {%- unless first -%},{%- endunless -%}
  {
    "type": "post",
    "title": {{ p.title | jsonify }},
    "url": {{ (base | append: p.url) | jsonify }},
    "date": {{ p.date | date: "%Y-%m-%d" | jsonify }},
    "tags": {{ p.tags | default: empty_array | jsonify }},
    "categories": {{ p.categories | default: empty_array | jsonify }},
    "excerpt": {{ p.excerpt | default: p.content | strip_html | strip_newlines | truncate: 180 | jsonify }},
    "content": {{ p.content | strip_html | strip_newlines | jsonify }},
    "pdf": {{ pdf_url | jsonify }}
  }
  {%- assign first = false -%}
{%- endfor -%}

{%- comment -%} 2) _data/matrix.yml（一般質問） {%- endcomment -%}
{%- if site.data.matrix -%}
  {%- assign rows = site.data.matrix.rows | default: site.data.matrix.categories | default: site.data.matrix -%}
  {%- for m in rows -%}
    {%- assign s = m.sakio -%}
    {%- assign rel = m.related | default: empty_array -%}
    {%- capture body -%}
      {{ s.session | default: "" }} {{ s.text | default: "" }}
      {%- for y in rel -%} {{ y.topic | default: "" }} {%- endfor -%}
    {%- endcapture -%}
    {%- assign month = s.month | default: "" -%}
    {%- assign anchor = "/pages/matrix.html#" | append: m.category | append: "-" | append: month -%}
    {%- assign pdf_raw = s.pdf | default: m.pdf | default: m.link | default: "" -%}
    {%- assign pdf_url = "" -%}
    {%- if pdf_raw != "" -%}{%- assign pdf_url = base | append: pdf_raw -%}{%- endif -%}

    {%- unless first -%},{%- endunless -%}
    {
      "type": "question",
      "title": {{ (m.category | append: "｜" | append: (s.session | default: s.month | default: "")) | jsonify }},
      "url": {{ (base | append: anchor) | jsonify }},
      "date": {{ (month | replace: "/", "-" ) | jsonify }},
      "tags": {{ m.tags | default: empty_array | jsonify }},
      "categories": ["一般質問"],
      "excerpt": {{ body | strip_html | strip_newlines | truncate: 180 | jsonify }},
      "content": {{ body | strip_html | strip_newlines | jsonify }},
      "pdf": {{ pdf_url | jsonify }}
    }
    {%- assign first = false -%}
  {%- endfor -%}
{%- endif -%}

{%- comment -%} 3) _data/promises.yml（公約） {%- endcomment -%}
{%- if site.data.promises -%}
  {%- assign P = site.data.promises.promises | default: site.data.promises -%}
  {%- for x in P -%}
    {%- assign pdf_raw = x.pdf | default: x.link | default: "" -%}
    {%- assign pdf_url = "" -%}
    {%- if pdf_raw != "" -%}{%- assign pdf_url = base | append: pdf_raw -%}{%- endif -%}
    {%- assign date_str = x.last_update | default: "" -%}
    {%- unless first -%},{%- endunless -%}
    {
      "type": "promise",
      "title": {{ x.title | default: "" | jsonify }},
      "url": {{ (base | append: "/pages/promise.html#id-" | append: x.id) | jsonify }},
      "date": {{ date_str | jsonify }},
      "tags": {{ x.tags | default: x.tag | default: empty_array | jsonify }},
      "categories": ["公約"],
      "excerpt": {{ x.detail | default: "" | strip_html | strip_newlines | truncate: 180 | jsonify }},
      "content": {{ (x.detail | default: "" ) | strip_html | strip_newlines | jsonify }},
      "pdf": {{ pdf_url | jsonify }}
    }
    {%- assign first = false -%}
  {%- endfor -%}
{%- endif -%}
"image": {% if p.images and p.images.size > 0 %}{{ p.images[0] | relative_url | jsonify }}{% else %}null{% endif %},

{%- comment -%} 4) _data/activity.yml（活動） {%- endcomment -%}
{%- if site.data.activity -%}
  {%- assign A = site.data.activity.items | default: site.data.activity -%}
  {%- for a in A -%}
    {%- assign pdf_raw = a.pdf | default: "" -%}
    {%- assign pdf_url = "" -%}
    {%- if pdf_raw != "" -%}{%- assign pdf_url = base | append: pdf_raw -%}{%- endif -%}
    {%- unless first -%},{%- endunless -%}
    {
      "type": "activity",
      "title": {{ a.title | default: "" | jsonify }},
      "url": {{ (base | append: "/pages/activity.html") | jsonify }},
      "date": {{ a.date | default: "" | jsonify }},
      "tags": {{ a.tags | default: a.tag | default: empty_array | jsonify }},
      "categories": {{ a.categories | default: a.category | default: empty_array | jsonify }},
      "excerpt": {{ a.summary | default: "" | strip_html | strip_newlines | truncate: 180 | jsonify }},
      "content": {{ a.summary | default: "" | strip_html | strip_newlines | jsonify }},
      "pdf": {{ pdf_url | jsonify }}
    }
    {%- assign first = false -%}
  {%- endfor -%}
{%- endif -%}

]

